# æ·»åŠ ç´¢å¼•

æˆ‘ä»¬å¾€ Elasticsearch æ·»åŠ æ•°æ®æ—¶éœ€è¦ç”¨åˆ° ç´¢å¼• â€”â€” ä¿å­˜ç›¸å…³æ•°æ®çš„åœ°æ–¹ã€‚ ç´¢å¼•å®é™…ä¸Šæ˜¯æŒ‡å‘ä¸€ä¸ªæˆ–è€…å¤šä¸ªç‰©ç† åˆ†ç‰‡ çš„ é€»è¾‘å‘½åç©ºé—´ ã€‚

ä¸€ä¸ª åˆ†ç‰‡ æ˜¯ä¸€ä¸ªåº•å±‚çš„ å·¥ä½œå•å…ƒ ï¼Œå®ƒä»…ä¿å­˜äº†å…¨éƒ¨æ•°æ®ä¸­çš„ä¸€éƒ¨åˆ†ã€‚ åœ¨åˆ†ç‰‡å†…éƒ¨æœºåˆ¶ä¸­ï¼Œæˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»åˆ†ç‰‡æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè€Œç°åœ¨æˆ‘ä»¬åªéœ€çŸ¥é“ä¸€ä¸ªåˆ†ç‰‡æ˜¯ä¸€ä¸ª Lucene çš„å®ä¾‹ï¼Œä»¥åŠå®ƒæœ¬èº«å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„æœç´¢å¼•æ“ã€‚ æˆ‘ä»¬çš„æ–‡æ¡£è¢«å­˜å‚¨å’Œç´¢å¼•åˆ°åˆ†ç‰‡å†…ï¼Œä½†æ˜¯åº”ç”¨ç¨‹åºæ˜¯ç›´æ¥ä¸ç´¢å¼•è€Œä¸æ˜¯ä¸åˆ†ç‰‡è¿›è¡Œäº¤äº’ã€‚

Elasticsearch æ˜¯åˆ©ç”¨åˆ†ç‰‡å°†æ•°æ®åˆ†å‘åˆ°é›†ç¾¤å†…å„å¤„çš„ã€‚åˆ†ç‰‡æ˜¯æ•°æ®çš„å®¹å™¨ï¼Œæ–‡æ¡£ä¿å­˜åœ¨åˆ†ç‰‡å†…ï¼Œåˆ†ç‰‡åˆè¢«åˆ†é…åˆ°é›†ç¾¤å†…çš„å„ä¸ªèŠ‚ç‚¹é‡Œã€‚ å½“ä½ çš„é›†ç¾¤è§„æ¨¡æ‰©å¤§æˆ–è€…ç¼©å°æ—¶ï¼Œ Elasticsearch ä¼šè‡ªåŠ¨çš„åœ¨å„èŠ‚ç‚¹ä¸­è¿ç§»åˆ†ç‰‡ï¼Œä½¿å¾—æ•°æ®ä»ç„¶å‡åŒ€åˆ†å¸ƒåœ¨é›†ç¾¤é‡Œã€‚

ä¸€ä¸ªåˆ†ç‰‡å¯ä»¥æ˜¯ ä¸» åˆ†ç‰‡æˆ–è€… å‰¯æœ¬ åˆ†ç‰‡ã€‚ ç´¢å¼•å†…ä»»æ„ä¸€ä¸ªæ–‡æ¡£éƒ½å½’å±äºä¸€ä¸ªä¸»åˆ†ç‰‡ï¼Œæ‰€ä»¥ä¸»åˆ†ç‰‡çš„æ•°ç›®å†³å®šç€ç´¢å¼•èƒ½å¤Ÿä¿å­˜çš„æœ€å¤§æ•°æ®é‡ã€‚

> **ğŸ¦‰ Note**
>
> æŠ€æœ¯ä¸Šæ¥è¯´ï¼Œä¸€ä¸ªä¸»åˆ†ç‰‡æœ€å¤§èƒ½å¤Ÿå­˜å‚¨ Integer.MAX_VALUE - 128 ä¸ªæ–‡æ¡£ï¼Œä½†æ˜¯å®é™…æœ€å¤§å€¼è¿˜éœ€è¦å‚è€ƒä½ çš„ä½¿ç”¨åœºæ™¯ï¼šåŒ…æ‹¬ä½ ä½¿ç”¨çš„ç¡¬ä»¶ï¼Œ æ–‡æ¡£çš„å¤§å°å’Œå¤æ‚ç¨‹åº¦ï¼Œç´¢å¼•å’ŒæŸ¥è¯¢æ–‡æ¡£çš„æ–¹å¼ä»¥åŠä½ æœŸæœ›çš„å“åº”æ—¶é•¿ã€‚


ä¸€ä¸ªå‰¯æœ¬åˆ†ç‰‡åªæ˜¯ä¸€ä¸ªä¸»åˆ†ç‰‡çš„æ‹·è´ã€‚å‰¯æœ¬åˆ†ç‰‡ä½œä¸ºç¡¬ä»¶æ•…éšœæ—¶ä¿æŠ¤æ•°æ®ä¸ä¸¢å¤±çš„å†—ä½™å¤‡ä»½ï¼Œå¹¶ä¸ºæœç´¢å’Œè¿”å›æ–‡æ¡£ç­‰è¯»æ“ä½œæä¾›æœåŠ¡ã€‚

åœ¨ç´¢å¼•å»ºç«‹çš„æ—¶å€™å°±å·²ç»ç¡®å®šäº†ä¸»åˆ†ç‰‡æ•°ï¼Œä½†æ˜¯å‰¯æœ¬åˆ†ç‰‡æ•°å¯ä»¥éšæ—¶ä¿®æ”¹ã€‚

è®©æˆ‘ä»¬åœ¨åŒ…å«ä¸€ä¸ªç©ºèŠ‚ç‚¹çš„é›†ç¾¤å†…åˆ›å»ºåä¸º blogs çš„ç´¢å¼•ã€‚ ç´¢å¼•åœ¨é»˜è®¤æƒ…å†µä¸‹ä¼šè¢«åˆ†é…5ä¸ªä¸»åˆ†ç‰‡ï¼Œ ä½†æ˜¯ä¸ºäº†æ¼”ç¤ºç›®çš„ï¼Œæˆ‘ä»¬å°†åˆ†é…3ä¸ªä¸»åˆ†ç‰‡å’Œä¸€ä»½å‰¯æœ¬ï¼ˆæ¯ä¸ªä¸»åˆ†ç‰‡æ‹¥æœ‰ä¸€ä¸ªå‰¯æœ¬åˆ†ç‰‡ï¼‰ï¼š

```json

PUT /blogs
{
   "settings" : {
      "number_of_shards" : 3,
      "number_of_replicas" : 1
   }
}

{
  "acknowledged": true,
  "shards_acknowledged": true,
  "index": "blogs"
}

```

æˆ‘ä»¬çš„é›†ç¾¤ç°åœ¨, æ‰€æœ‰3ä¸ªä¸»åˆ†ç‰‡éƒ½è¢«åˆ†é…åœ¨ Node 1 ã€‚

![3ä¸ªåˆ†ç‰‡åœ¨ä¸€ä¸ªèŠ‚ç‚¹](https://github.com/Kua-Fu/blog-book-images/blob/main/elastic/basic/elas_0202.png?raw=true)


âš ï¸ æœ€æ–°ç‰ˆæœ¬ä¸­ï¼Œåˆ›å»ºç´¢å¼•é»˜è®¤ä¸»åˆ†ç‰‡ä¸º1ï¼Œå‰¯æœ¬ä¹Ÿæ˜¯1ï¼Œä¸‹é¢æ˜¯elastic cloudç¤ºä¾‹

```json

PUT /blogs
{
   "settings" : {
      "number_of_shards" : 3,
      "number_of_replicas" : 2
   }
}

{
  "acknowledged": true,
  "shards_acknowledged": true,
  "index": "blogs"
}

```

![3ä¸ªåˆ†ç‰‡åœ¨2ä¸ªèŠ‚ç‚¹](https://github.com/Kua-Fu/blog-book-images/blob/main/elastic/basic/es-basic-create-an-index.jpg?raw=true)

å¦‚æœæˆ‘ä»¬ç°åœ¨æŸ¥çœ‹é›†ç¾¤å¥åº·ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼š

```json

GET _cluster/health

{
  "cluster_name": "a2ff16d9aa2645dc87ab1714e6e16a84",
  "status": "yellow", 0ï¸âƒ£
  "timed_out": false,
  "number_of_nodes": 3,
  "number_of_data_nodes": 2,
  "active_primary_shards": 95,
  "active_shards": 190,
  "relocating_shards": 0,
  "initializing_shards": 0,
  "unassigned_shards": 3, 1ï¸âƒ£
  "delayed_unassigned_shards": 0,
  "number_of_pending_tasks": 0,
  "number_of_in_flight_fetch": 0,
  "task_max_waiting_in_queue_millis": 0,
  "active_shards_percent_as_number": 98.44559585492227
}

```

* 0ï¸âƒ£ é›†ç¾¤ status å€¼ä¸º yellow

* 1ï¸âƒ£ æ²¡æœ‰è¢«åˆ†é…åˆ°ä»»ä½•èŠ‚ç‚¹çš„å‰¯æœ¬æ•°

é›†ç¾¤çš„å¥åº·çŠ¶å†µä¸º yellow åˆ™è¡¨ç¤ºå…¨éƒ¨ ä¸» åˆ†ç‰‡éƒ½æ­£å¸¸è¿è¡Œï¼ˆé›†ç¾¤å¯ä»¥æ­£å¸¸æœåŠ¡æ‰€æœ‰è¯·æ±‚ï¼‰ï¼Œä½†æ˜¯ å‰¯æœ¬ åˆ†ç‰‡æ²¡æœ‰å…¨éƒ¨å¤„åœ¨æ­£å¸¸çŠ¶æ€ã€‚ å®é™…ä¸Šï¼Œæ‰€æœ‰3ä¸ªå‰¯æœ¬åˆ†ç‰‡éƒ½æ˜¯ unassigned â€”â€” å®ƒä»¬éƒ½æ²¡æœ‰è¢«åˆ†é…åˆ°ä»»ä½•èŠ‚ç‚¹ã€‚ åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šæ—¢ä¿å­˜åŸå§‹æ•°æ®åˆä¿å­˜å‰¯æœ¬æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºä¸€æ—¦å¤±å»äº†é‚£ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬ä¹Ÿå°†ä¸¢å¤±è¯¥èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰å‰¯æœ¬æ•°æ®ã€‚

å½“å‰æˆ‘ä»¬çš„é›†ç¾¤æ˜¯æ­£å¸¸è¿è¡Œçš„ï¼Œä½†æ˜¯åœ¨ç¡¬ä»¶æ•…éšœæ—¶æœ‰ä¸¢å¤±æ•°æ®çš„é£é™©ã€‚
