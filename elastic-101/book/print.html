<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>elastic-101</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">ç®€ä»‹</a></li><li class="chapter-item expanded affix "><li class="part-title">æŠ€æœ¯æ–‡ç« </li><li class="chapter-item expanded "><a href="article/office/blog.html"><strong aria-hidden="true">1.</strong> elasticsearch å®˜æ–¹åšå®¢</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="article/office/blog/bulk-reject.html"><strong aria-hidden="true">1.1.</strong> bulk è¢«æ‹’ç»</a></li></ol></li><li class="chapter-item expanded "><a href="article/office/api.html"><strong aria-hidden="true">2.</strong> elasticsearch æ¥å£æ–‡æ¡£</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="article/office/ism.html"><strong aria-hidden="true">2.1.</strong> åä¸ºäº‘CSSç”Ÿå‘½å‘¨æœŸç®¡ç†</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">å®é™…ä½¿ç”¨</li><li class="chapter-item expanded "><a href="use/backup/backup.html"><strong aria-hidden="true">3.</strong> elasticsearché›†ç¾¤å¤‡ä»½</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="use/backup/snapshot.html"><strong aria-hidden="true">3.1.</strong> ä½¿ç”¨å¿«ç…§å¤‡ä»½</a></li><li class="chapter-item expanded "><a href="use/backup/meta.html"><strong aria-hidden="true">3.2.</strong> åªå¤‡ä»½é›†ç¾¤ä¸­çš„ç­–ç•¥ã€æ¨¡ç‰ˆç­‰ä¿¡æ¯</a></li></ol></li><li class="chapter-item expanded "><a href="use/reindex/reindex.html"><strong aria-hidden="true">4.</strong> reindex è¿‡ç¨‹</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="use/reindex/add-field.html"><strong aria-hidden="true">4.1.</strong> reindexæ·»åŠ æ–°å­—æ®µ</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">ä¸šåŠ¡æŠ¥é”™å¤„ç†</li><li class="chapter-item expanded affix "><li class="part-title">åŸç†æºç </li><li class="chapter-item expanded "><a href="lucene/intro.html"><strong aria-hidden="true">5.</strong> luceneä»‹ç»</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">elastic-101</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="ç®€ä»‹"><a class="header" href="#ç®€ä»‹">ç®€ä»‹</a></h1>
<p>elastic-101 å°†ä»‹ç»ä¸€ç³»åˆ— elasticsearch ç›¸å…³çš„æŠ€æœ¯æ¦‚å¿µã€åŸç†ï¼Œæ€»ç»“è‡ªå·±å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="å®˜æ–¹åšå®¢"><a class="header" href="#å®˜æ–¹åšå®¢">å®˜æ–¹åšå®¢</a></h1>
<ol>
<li><a href="https://www.elastic.co/cn/blog/why-am-i-seeing-bulk-rejections-in-my-elasticsearch-cluster">Why am I seeing bulk rejections in my Elasticsearch cluster?</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bulk-è¢«æ‹’ç»"><a class="header" href="#bulk-è¢«æ‹’ç»">bulk è¢«æ‹’ç»</a></h1>
<p><a href="https://www.elastic.co/cn/blog/why-am-i-seeing-bulk-rejections-in-my-elasticsearch-cluster">åŸæ–‡: Why am I seeing bulk rejections in my Elasticsearch cluster?</a></p>
<p>Elasticsearch supports a wide range of use-cases across our user base, and more and more of these rely on fast indexing to quickly get large amounts of data into Elasticsearch. Even though Elasticsearch is fast and index performance is continually improved, it is still possible to overwhelm it. At that point you typically see parts of bulk requests getting rejected. In this blog post we will look at the causes and how to avoid it.</p>
<p>åœ¨æˆ‘ä»¬çš„ç”¨æˆ·ç¾¤äº† elasticsearch æœ‰å¹¿æ³›çš„ä½¿ç”¨ç®¡ç†ï¼Œè¶Šæ¥è¶Šå¤šçš„å®¢æˆ·ä¾èµ–å¤§é‡æ•°æ®çš„å¿«é€Ÿç´¢å¼•ã€‚å°½ç®¡ elasticsearch é€Ÿåº¦å¾ˆå¿«ï¼Œç´¢å¼•æ€§èƒ½ä¹Ÿåœ¨ä¸æ–­æé«˜ï¼Œä»ç„¶å¯èƒ½è¾¾åˆ°å³°å€¼ã€‚æ­¤æ—¶ï¼Œé€šå¸¸å¯ä»¥çœ‹åˆ°éƒ¨åˆ†å†™å…¥è¯·æ±‚è¢«æ‹’ç»ã€‚ä¸‹æ–‡å°†æ¢è®¨åŸå› å’Œå¦‚ä½•é¿å…è¯·æ±‚è¢«æ‹’ç»ã€‚</p>
<p>This is the second installment in a series of blog posts where we look at and discuss your common questions. The first installment discussed and provided guidelines around &quot;How many shards one should aim to have in an Elasticsearch cluster?&quot;</p>
<p>è¿™æ˜¯ä¸€ç³»åˆ—æ–‡ç« ä¸­çš„ç¬¬äºŒç¯‡ã€‚ç¬¬ä¸€éƒ¨åˆ†æ–‡ç« å¯ä»¥è¯¦è§ <a href="https://www.elastic.co/cn/blog/how-many-shards-should-i-have-in-my-elasticsearch-cluster">How many shards one should aim to have in an Elasticsearch cluster?</a></p>
<h2 id="what-happens-when-a-bulk-indexing-request-is-sent-to-elasticsearch"><a class="header" href="#what-happens-when-a-bulk-indexing-request-is-sent-to-elasticsearch">What happens when a bulk indexing request is sent to Elasticsearch?</a></h2>
<p>å½“ä¸€ä¸ª bulk è¯·æ±‚å‘é€åˆ°elasticsearch, è¯·æ±‚åä¼šå‘ç”Ÿä»€ä¹ˆ?</p>
<p>Letâ€™s start at the beginning and look at what happens behind the scenes when a bulk indexing request is sent to Elasticsearch.</p>
<p>è®©æˆ‘ä»¬ä»å¤´å¼€å§‹ï¼Œçœ‹çœ‹å½“æ‰¹é‡ç´¢å¼•è¯·æ±‚å‘é€åˆ° elasticsearch æ—¶å€™ï¼Œåå°ä¼šå‘ç”Ÿä»€ä¹ˆ?</p>
<p>When a bulk request arrives at a node in the cluster, it is, in its entirety, put on the bulk queue and processed by the threads in the bulk thread pool. The node that receives the request is referred to as the coordinating node as it manages the life of the request and assembles the response. This can be a node dedicated to just coordinating requests or one of the data nodes in the cluster.</p>
<p>å½“ bulk è¯·æ±‚åˆ°è¾¾é›†ç¾¤ä¸­çš„æŸä¸ªèŠ‚ç‚¹æ—¶å€™ï¼Œè¯·æ±‚è¢«æ·»åŠ åˆ° bulkè¯·æ±‚é˜Ÿåˆ—ä¸­ï¼Œå¹¶ä¸”è¯¥è¯·æ±‚ä¼šè¢« bulkçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¤„ç†ã€‚æ¥æ”¶è¯·æ±‚çš„èŠ‚ç‚¹è¢«ç§°ä¸ºåè°ƒèŠ‚ç‚¹ï¼Œå› ä¸ºå®ƒä¼šç®¡ç†è¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸå¹¶ä¸”å“åº”å®¢æˆ·ç«¯è¯·æ±‚ã€‚åè°ƒèŠ‚ç‚¹å¯ä»¥æ˜¯ä¸€ä¸ªä¸“æœ‰èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥æ˜¯é›†ç¾¤ä¸­çš„ä¸€ä¸ªæ•°æ®èŠ‚ç‚¹ï¼Œæ‰¿æ‹…ç€åè°ƒåŠŸèƒ½ã€‚</p>
<p>A bulk request can contain documents destined for multiple indices and shards. The first processing step is therefore to split it up based on which shards the documents need to be routed to. Once this is done, each bulk sub-request is forwarded to the data node that holds the corresponding primary shard, and it is there enqueued on that nodeâ€™s bulk queue. If there is no more space available on the queue, the coordinating node will be notified that the bulk sub-request has been rejected.</p>
<p>The bulk thread pool processes requests from the queue and documents are forwarded to replica shards as part of this processing. Once the sub-request has completed, a response is sent to the coordinating node.</p>
<p>Once all sub-requests have completed or been rejected, a response is created and returned to the client. It is possible, and even likely, that only a portion of the documents within a bulk request might have been rejected.</p>
<p>ä¸€ä¸ª bulk è¯·æ±‚å¯ä»¥åŒ…å«æŒ‡å‘å¤šä¸ªç´¢å¼•å¤šä¸ªåˆ†ç‰‡çš„æ–‡æ¡£ã€‚bulk è¯·æ±‚</p>
<p>ï¼ˆ1ï¼‰ç¬¬ä¸€ä¸ªæ­¥éª¤ä¼šæŠŠè¯·æ±‚æ‹†åˆ†åˆ°ä¸åŒçš„åˆ†ç‰‡ä¸­ï¼Œæ ¹æ®æ–‡æ¡£ä¿¡æ¯ï¼Œè®¡ç®—è·¯ç”±åˆ°çš„åˆ†ç‰‡ï¼›</p>
<p>ï¼ˆ2ï¼‰ç¬¬äºŒä¸ªæ­¥éª¤ä¼šæŠŠè¢«æ‹†åˆ†çš„å­è¯·æ±‚åˆ†å‘åˆ°ä¸»åˆ†ç‰‡èŠ‚ç‚¹ï¼Œå­è¯·æ±‚ä¼šè¢«æ·»åŠ åˆ°å¯¹åº”èŠ‚ç‚¹çš„bulkè¯·æ±‚é˜Ÿåˆ—ï¼›</p>
<p>ï¼ˆ3ï¼‰å¦‚æœå­è¯·æ±‚æ‰€å¯¹åº”çš„èŠ‚ç‚¹ bulkè¯·æ±‚é˜Ÿåˆ—å·²ç»å æ»¡ï¼Œåˆ™åè°ƒèŠ‚ç‚¹ä¼šæ”¶åˆ°æ‹’ç»è¯·æ±‚é€šçŸ¥ï¼›</p>
<p>ï¼ˆ4ï¼‰ä¸»åˆ†ç‰‡èŠ‚ç‚¹å­˜åœ¨å¤§å®¹é‡çš„çº¿ç¨‹æ± ï¼Œç”¨äºå¤„ç† bulkå­è¯·æ±‚ï¼Œå¹¶ä¸”ä¼šå°†æ–‡æ¡£è½¬å‘åˆ°å‰¯æœ¬èŠ‚ç‚¹ï¼Œå‰¯æœ¬èŠ‚ç‚¹æ–‡æ¡£bulkä¹Ÿæ˜¯bulkå­è¯·æ±‚çš„ä¸€éƒ¨åˆ†ï¼Œå½“bulkå­è¯·æ±‚å¤„ç†å®Œæˆï¼Œåè°ƒèŠ‚ç‚¹å°†æ”¶åˆ°å“åº”ï¼›</p>
<p>ï¼ˆ5ï¼‰å½“æ‰€æœ‰çš„å­è¯·æ±‚éƒ½å®Œæˆæˆ–è€…æ‹’ç»ï¼Œå®¢æˆ·ç«¯å°†æ¥æ”¶åˆ°bulkå“åº”ã€‚æœ‰å¯èƒ½çš„åœºæ™¯æ˜¯ï¼Œéƒ¨åˆ†æ–‡æ¡£å†™å…¥è¢«æ‹’ç»ï¼Œéƒ¨åˆ†æ–‡æ¡£å†™å…¥æˆåŠŸã€‚</p>
<p>The reason Elasticsearch is designed with request queues of limited size is to protect the cluster from being overloaded, which increases stability and reliability. If there were no limits in place, clients could very easily bring a whole cluster down through bad or malicious behaviour. The limits that are in place have been set based on our extensive experience supporting Elasticsearch for different types of use-cases.</p>
<p>è®¾è®¡bulkè¯·æ±‚é˜Ÿåˆ—ï¼Œå¹¶ä¸”é™åˆ¶é˜Ÿåˆ—é•¿åº¦ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢è¯·æ±‚è¿‡å¤šï¼Œå¯¼è‡´é›†ç¾¤è¿‡è½½ï¼Œå¯ä»¥æé«˜é›†ç¾¤ç¨³å®šæ€§å’Œå¯é æ€§ã€‚å¦‚æœæ²¡æœ‰é•¿åº¦é™åˆ¶çš„è¯·æ±‚é˜Ÿåˆ—æœºåˆ¶ï¼Œå®¢æˆ·ç«¯å¾ˆå®¹æ˜“ç”±äºä¸åˆé€‚æ“ä½œï¼Œæˆ–è€…æ¶æ„æ“ä½œï¼Œä½¿å¾—é›†ç¾¤å´©æºƒğŸ´ã€‚æ ¹æ®ç°æœ‰å®¢æˆ·çš„å®é™…ä½¿ç”¨åœºæ™¯ç»éªŒï¼Œæˆ‘ä»¬è®¾ç½®äº†ç°æœ‰çš„é˜Ÿåˆ—é•¿åº¦ã€‚</p>
<p>When using the HTTP interface, requests that results in at least a partial rejection will return with response code 429, 'Too many requests'. The principle also applies when the transport protocol is used, although the protocol and interface naturally is different. Applications and clients may report these errors back to the user in different ways, and some may even attempt to handle this automatically by retrying any rejected documents.</p>
<p>å½“é€šè¿‡ httpåè®®å‘é€bulkè¯·æ±‚æ—¶ï¼Œå¦‚æœbulkè¯·æ±‚ä¸­å­˜åœ¨éƒ¨åˆ†è¢«æ‹’ç»çš„å­è¯·æ±‚ï¼Œbulkè¯·æ±‚çš„è¿”å›çŠ¶æ€ç æ˜¯429ï¼Œè¡¨ç¤ºè¯·æ±‚å¤ªå¤šã€‚å½“é€šè¿‡ tcpåè®®å‘é€bulkè¯·æ±‚æ—¶ï¼Œè¿™ä¸ªåŸåˆ™ä¹Ÿæ˜¯ä¸€æ ·ï¼Œä½†æ˜¯åè®®å’Œæ¥å£ä¼šæœ‰ä¸åŒè¡¨ç°ã€‚bulkè¯·æ±‚çš„å®¢æˆ·ç«¯ï¼ˆå¯èƒ½æ˜¯æŸä¸ªåº”ç”¨ï¼‰ä¼šå°†429æŠ¥é”™ä»¥ä¸åŒæ–¹å¼æŠ¥å‘Šç»™ç”¨æˆ·ã€‚å®¢æˆ·ç«¯ç¨‹åºå¯èƒ½ä¼šåœ¨æ¥æ”¶åˆ°429æŠ¥é”™åï¼Œè‡ªåŠ¨é‡è¯•ï¼Œç»§ç»­ä¸Šä¼ å†™å…¥å¤±è´¥æ–‡æ¡£ã€‚</p>
<h2 id="how-can-we-test-this-in-practice"><a class="header" href="#how-can-we-test-this-in-practice">How can we test this in practice?</a></h2>
<p>å¦‚æœå®é™…æµ‹è¯•bulkè¯·æ±‚ï¼Ÿ</p>
<p>In order to illustrate the practical impact of this behaviour, we devised a simple test where we use our benchmarking tool Rally to run bulk indexing requests against a couple of Elastic Cloud clusters with varying number of data nodes. Configuration and instructions on how to run Rally is available in this gist.</p>
<p>The same indexing workload was run against three different Elastic Cloud clusters. We have been indexing with one replica shard configured wherever possible. The clusters consisted of one, two and three data nodes respectively, with each data node having 8GB RAM (4GB heap for Elasticsearch, 4GB native memory). Invoking the GET /_nodes/thread_pool API we could see that each data node by default had a fixed bulk thread pool size of two with a queue size of 200:</p>
<pre><code class="language-json">
%&gt; curl -XGET http://&lt;es_url&gt;:&lt;es_port&gt;/_nodes/thread_pool&lt;/es_port&gt;&lt;/es_url&gt;
&quot;bulk&quot;: {
&quot;type&quot;: &quot;fixed&quot;,
&quot;min&quot;: 2,
&quot;max&quot;: 2,
&quot;queue_size&quot;: 200
}

</code></pre>
<p>ä¸‹é¢æˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ªç®€å•çš„æµ‹è¯•ï¼Œæµ‹è¯•bulkæ€§èƒ½ï¼Œæµ‹è¯•å·¥å…·æ˜¯ <a href="https://github.com/elastic/rally">rally</a>ï¼Œæµ‹è¯•å¤šä¸ªå…·æœ‰ä¸åŒèŠ‚ç‚¹çš„é›†ç¾¤ã€‚</p>
<p>åœ¨ä¸‰ä¸ªä¸åŒé…ç½®çš„ESå®ä¾‹ï¼Œæˆ‘ä»¬ä¼šæ‰§è¡Œç›¸åŒçš„bulkè¯·æ±‚æµ‹è¯•ã€‚ä¸‰ä¸ªESå®ä¾‹ï¼Œåˆ†åˆ«æ˜¯1ä¸ªèŠ‚ç‚¹ã€2ä¸ªèŠ‚ç‚¹ã€3ä¸ªèŠ‚ç‚¹ï¼Œå…¶ä¸­æ¯ä¸ªèŠ‚ç‚¹é…ç½®éƒ½æ˜¯ç›¸åŒçš„ï¼ˆ 8GB å†…å­˜ï¼Œ4Gè®¾ç½®ä¸ºES å †å†…å­˜ï¼Œ4Gè®¾ç½®ä¸ºèŠ‚ç‚¹å†…å­˜ï¼‰ã€‚å¯ä»¥é€šè¿‡æ¥å£<code>GET /_nodes/thread_pool</code> æ¥å£æŸ¥çœ‹</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span>
<span class="boring">fn main() {
</span>GET _nodes/thread_pool

<span class="boring">
</span><span class="boring">&quot;_nodes&quot;: {
</span><span class="boring">  &quot;total&quot;: 3,
</span><span class="boring">  &quot;successful&quot;: 3,
</span><span class="boring">  &quot;failed&quot;: 0
</span><span class="boring">},
</span><span class="boring">&quot;cluster_name&quot;: &quot;a2ff16d9aa2645dc87ab1714e6e16a84&quot;,
</span><span class="boring">&quot;nodes&quot;: {
</span><span class="boring">  &quot;juVnJa6TQ7a2c3v065Gz3w&quot;: {
</span><span class="boring">    &quot;name&quot;: &quot;instance-0000000000&quot;,
</span><span class="boring">    &quot;transport_address&quot;: &quot;10.42.10.154:19303&quot;,
</span><span class="boring">    &quot;host&quot;: &quot;10.42.10.154&quot;,
</span><span class="boring">    &quot;ip&quot;: &quot;10.42.10.154&quot;,
</span><span class="boring">    &quot;version&quot;: &quot;8.3.1&quot;,
</span><span class="boring">    &quot;build_flavor&quot;: &quot;default&quot;,
</span><span class="boring">    &quot;build_type&quot;: &quot;docker&quot;,
</span><span class="boring">    &quot;build_hash&quot;: &quot;b9a6b2867996ba92ceac66cb5bafc6db25e7910e&quot;,
</span><span class="boring">    &quot;roles&quot;: [
</span><span class="boring">      &quot;data_content&quot;,
</span><span class="boring">      &quot;data_hot&quot;,
</span><span class="boring">      &quot;ingest&quot;,
</span><span class="boring">      &quot;master&quot;,
</span><span class="boring">      &quot;remote_cluster_client&quot;,
</span><span class="boring">      &quot;transform&quot;
</span><span class="boring">    ],
</span><span class="boring">    &quot;attributes&quot;: {
</span><span class="boring">      &quot;logical_availability_zone&quot;: &quot;zone-0&quot;,
</span><span class="boring">      &quot;server_name&quot;: &quot;instance-0000000000.a2ff16d9aa2645dc87ab1714e6e16a84&quot;,
</span><span class="boring">      &quot;availability_zone&quot;: &quot;us-central1-a&quot;,
</span><span class="boring">      &quot;xpack.installed&quot;: &quot;true&quot;,
</span><span class="boring">      &quot;data&quot;: &quot;hot&quot;,
</span><span class="boring">      &quot;instance_configuration&quot;: &quot;gcp.es.datahot.n2.68x10x45&quot;,
</span><span class="boring">      &quot;region&quot;: &quot;unknown-region&quot;
</span><span class="boring">    },
</span><span class="boring">    &quot;thread_pool&quot;: {
</span><span class="boring">      &quot;force_merge&quot;: {
</span><span class="boring">        &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">        &quot;size&quot;: 1,
</span><span class="boring">        &quot;queue_size&quot;: -1
</span><span class="boring">      },
</span><span class="boring">      &quot;search_coordination&quot;: {
</span><span class="boring">        &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">        &quot;size&quot;: 1,
</span><span class="boring">        &quot;queue_size&quot;: 1000
</span><span class="boring">      },
</span><span class="boring">      &quot;searchable_snapshots_cache_fetch_async&quot;: {
</span><span class="boring">        &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">        &quot;core&quot;: 0,
</span><span class="boring">        &quot;max&quot;: 6,
</span><span class="boring">        &quot;keep_alive&quot;: &quot;30s&quot;,
</span><span class="boring">        &quot;queue_size&quot;: -1
</span><span class="boring">      },
</span><span class="boring">      &quot;ml_datafeed&quot;: {
</span><span class="boring">        &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">        &quot;core&quot;: 1,
</span><span class="boring">        &quot;max&quot;: 512,
</span><span class="boring">        &quot;keep_alive&quot;: &quot;1m&quot;,
</span><span class="boring">        &quot;queue_size&quot;: -1
</span><span class="boring">      },
</span><span class="boring">      &quot;snapshot_meta&quot;: {
</span><span class="boring">        &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">        &quot;core&quot;: 1,
</span><span class="boring">        &quot;max&quot;: 6,
</span><span class="boring">        &quot;keep_alive&quot;: &quot;30s&quot;,
</span><span class="boring">        &quot;queue_size&quot;: -1
</span><span class="boring">      },
</span><span class="boring">      &quot;fetch_shard_started&quot;: {
</span><span class="boring">        &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">        &quot;core&quot;: 1,
</span><span class="boring">        &quot;max&quot;: 4,
</span><span class="boring">        &quot;keep_alive&quot;: &quot;5m&quot;,
</span><span class="boring">        &quot;queue_size&quot;: -1
</span><span class="boring">      },
</span><span class="boring">      &quot;rollup_indexing&quot;: {
</span><span class="boring">        &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">        &quot;size&quot;: 1,
</span><span class="boring">        &quot;queue_size&quot;: -1
</span><span class="boring">      },
</span><span class="boring">      &quot;search&quot;: {
</span><span class="boring">        &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">        &quot;size&quot;: 4,
</span><span class="boring">        &quot;queue_size&quot;: 1000
</span><span class="boring">      },
</span><span class="boring">      &quot;cluster_coordination&quot;: {
</span><span class="boring">        &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">        &quot;size&quot;: 1,
</span><span class="boring">        &quot;queue_size&quot;: -1
</span><span class="boring">      },
</span><span class="boring">      &quot;security-crypto&quot;: {
</span><span class="boring">        &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">        &quot;size&quot;: 1,
</span><span class="boring">        &quot;queue_size&quot;: 1000
</span><span class="boring">      },
</span><span class="boring">      &quot;ccr&quot;: {
</span><span class="boring">        &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">        &quot;size&quot;: 32,
</span><span class="boring">        &quot;queue_size&quot;: 100
</span><span class="boring">      },
</span><span class="boring">      &quot;flush&quot;: {
</span><span class="boring">        &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">        &quot;core&quot;: 1,
</span><span class="boring">        &quot;max&quot;: 1,
</span><span class="boring">        &quot;keep_alive&quot;: &quot;5m&quot;,
</span><span class="boring">        &quot;queue_size&quot;: -1
</span><span class="boring">      },
</span><span class="boring">      &quot;fetch_shard_store&quot;: {
</span><span class="boring">        &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">        &quot;core&quot;: 1,
</span><span class="boring">        &quot;max&quot;: 4,
</span><span class="boring">        &quot;keep_alive&quot;: &quot;5m&quot;,
</span><span class="boring">        &quot;queue_size&quot;: -1
</span><span class="boring">      },
</span><span class="boring">      &quot;ml_utility&quot;: {
</span><span class="boring">        &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">        &quot;core&quot;: 1,
</span><span class="boring">        &quot;max&quot;: 2048,
</span><span class="boring">        &quot;keep_alive&quot;: &quot;10m&quot;,
</span><span class="boring">        &quot;queue_size&quot;: -1
</span><span class="boring">      },
</span><span class="boring">      &quot;get&quot;: {
</span><span class="boring">        &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">        &quot;size&quot;: 2,
</span><span class="boring">        &quot;queue_size&quot;: 1000
</span><span class="boring">      },
</span><span class="boring">      &quot;system_read&quot;: {
</span><span class="boring">        &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">        &quot;size&quot;: 1,
</span><span class="boring">        &quot;queue_size&quot;: 2000
</span><span class="boring">      },
</span><span class="boring">      &quot;system_critical_read&quot;: {
</span><span class="boring">        &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">        &quot;size&quot;: 1,
</span><span class="boring">        &quot;queue_size&quot;: 2000
</span><span class="boring">      },
</span><span class="boring">      &quot;write&quot;: {
</span><span class="boring">        &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">        &quot;size&quot;: 2,
</span><span class="boring">        &quot;queue_size&quot;: 10000
</span><span class="boring">      },
</span><span class="boring">      &quot;watcher&quot;: {
</span><span class="boring">        &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">        &quot;size&quot;: 10,
</span><span class="boring">        &quot;queue_size&quot;: 1000
</span><span class="boring">      },
</span><span class="boring">      &quot;security-token-key&quot;: {
</span><span class="boring">        &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">        &quot;size&quot;: 1,
</span><span class="boring">        &quot;queue_size&quot;: 1000
</span><span class="boring">      },
</span><span class="boring">      &quot;system_critical_write&quot;: {
</span><span class="boring">        &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">        &quot;size&quot;: 1,
</span><span class="boring">        &quot;queue_size&quot;: 1500
</span><span class="boring">      },
</span><span class="boring">      &quot;refresh&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 1,
</span><span class="boring">   &quot;max&quot;: 1,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;5m&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;repository_azure&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 0,
</span><span class="boring">   &quot;max&quot;: 5,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;30s&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;vector_tile_generation&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;system_write&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: 1000
</span><span class="boring"> },
</span><span class="boring"> &quot;generic&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 4,
</span><span class="boring">   &quot;max&quot;: 128,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;30s&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;warmer&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 1,
</span><span class="boring">   &quot;max&quot;: 1,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;5m&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;auto_complete&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: 100
</span><span class="boring"> },
</span><span class="boring"> &quot;azure_event_loop&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 0,
</span><span class="boring">   &quot;max&quot;: 1,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;30s&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;management&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 1,
</span><span class="boring">   &quot;max&quot;: 2,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;5m&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;analyze&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: 16
</span><span class="boring"> },
</span><span class="boring"> &quot;searchable_snapshots_cache_prewarming&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 0,
</span><span class="boring">   &quot;max&quot;: 16,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;30s&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;ml_job_comms&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 4,
</span><span class="boring">   &quot;max&quot;: 2048,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;1m&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;snapshot&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 1,
</span><span class="boring">   &quot;max&quot;: 1,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;5m&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;search_throttled&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: 100
</span><span class="boring"> }
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">nEBN-aVTcKiJfoT87LgKA&quot;: {
</span><span class="boring">&quot;name&quot;: &quot;instance-0000000001&quot;,
</span><span class="boring">&quot;transport_address&quot;: &quot;10.42.0.133:19375&quot;,
</span><span class="boring">&quot;host&quot;: &quot;10.42.0.133&quot;,
</span><span class="boring">&quot;ip&quot;: &quot;10.42.0.133&quot;,
</span><span class="boring">&quot;version&quot;: &quot;8.3.1&quot;,
</span><span class="boring">&quot;build_flavor&quot;: &quot;default&quot;,
</span><span class="boring">&quot;build_type&quot;: &quot;docker&quot;,
</span><span class="boring">&quot;build_hash&quot;: &quot;b9a6b2867996ba92ceac66cb5bafc6db25e7910e&quot;,
</span><span class="boring">&quot;roles&quot;: [
</span><span class="boring"> &quot;data_content&quot;,
</span><span class="boring"> &quot;data_hot&quot;,
</span><span class="boring"> &quot;ingest&quot;,
</span><span class="boring"> &quot;master&quot;,
</span><span class="boring"> &quot;remote_cluster_client&quot;,
</span><span class="boring"> &quot;transform&quot;
</span><span class="boring">],
</span><span class="boring">&quot;attributes&quot;: {
</span><span class="boring"> &quot;data&quot;: &quot;hot&quot;,
</span><span class="boring"> &quot;server_name&quot;: &quot;instance-0000000001.a2ff16d9aa2645dc87ab1714e6e16a84&quot;,
</span><span class="boring"> &quot;instance_configuration&quot;: &quot;gcp.es.datahot.n2.68x10x45&quot;,
</span><span class="boring"> &quot;region&quot;: &quot;unknown-region&quot;,
</span><span class="boring"> &quot;availability_zone&quot;: &quot;us-central1-b&quot;,
</span><span class="boring"> &quot;logical_availability_zone&quot;: &quot;zone-1&quot;,
</span><span class="boring"> &quot;xpack.installed&quot;: &quot;true&quot;
</span><span class="boring">},
</span><span class="boring">&quot;thread_pool&quot;: {
</span><span class="boring"> &quot;force_merge&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;search_coordination&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: 1000
</span><span class="boring"> },
</span><span class="boring"> &quot;searchable_snapshots_cache_fetch_async&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 0,
</span><span class="boring">   &quot;max&quot;: 6,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;30s&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;ml_datafeed&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 1,
</span><span class="boring">   &quot;max&quot;: 512,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;1m&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;snapshot_meta&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 1,
</span><span class="boring">   &quot;max&quot;: 6,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;30s&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;fetch_shard_started&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 1,
</span><span class="boring">   &quot;max&quot;: 4,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;5m&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;rollup_indexing&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;search&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 4,
</span><span class="boring">   &quot;queue_size&quot;: 1000
</span><span class="boring"> },
</span><span class="boring"> &quot;cluster_coordination&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;security-crypto&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: 1000
</span><span class="boring"> },
</span><span class="boring"> &quot;ccr&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 32,
</span><span class="boring">   &quot;queue_size&quot;: 100
</span><span class="boring"> },
</span><span class="boring"> &quot;flush&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 1,
</span><span class="boring">   &quot;max&quot;: 1,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;5m&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;fetch_shard_store&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 1,
</span><span class="boring">   &quot;max&quot;: 4,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;5m&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;ml_utility&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 1,
</span><span class="boring">   &quot;max&quot;: 2048,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;10m&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;get&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 2,
</span><span class="boring">   &quot;queue_size&quot;: 1000
</span><span class="boring"> },
</span><span class="boring"> &quot;system_read&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: 2000
</span><span class="boring"> },
</span><span class="boring"> &quot;system_critical_read&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: 2000
</span><span class="boring"> },
</span><span class="boring"> &quot;write&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 2,
</span><span class="boring">   &quot;queue_size&quot;: 10000
</span><span class="boring"> },
</span><span class="boring"> &quot;watcher&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 10,
</span><span class="boring">   &quot;queue_size&quot;: 1000
</span><span class="boring"> },
</span><span class="boring"> &quot;security-token-key&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: 1000
</span><span class="boring"> },
</span><span class="boring"> &quot;system_critical_write&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: 1500
</span><span class="boring"> },
</span><span class="boring"> &quot;refresh&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 1,
</span><span class="boring">   &quot;max&quot;: 1,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;5m&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;repository_azure&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 0,
</span><span class="boring">   &quot;max&quot;: 5,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;30s&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;vector_tile_generation&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;system_write&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: 1000
</span><span class="boring"> },
</span><span class="boring"> &quot;generic&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 4,
</span><span class="boring">   &quot;max&quot;: 128,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;30s&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;warmer&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 1,
</span><span class="boring">   &quot;max&quot;: 1,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;5m&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;auto_complete&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: 100
</span><span class="boring"> },
</span><span class="boring"> &quot;azure_event_loop&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 0,
</span><span class="boring">   &quot;max&quot;: 1,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;30s&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;management&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 1,
</span><span class="boring">   &quot;max&quot;: 2,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;5m&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;analyze&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: 16
</span><span class="boring"> },
</span><span class="boring"> &quot;searchable_snapshots_cache_prewarming&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 0,
</span><span class="boring">   &quot;max&quot;: 16,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;30s&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;ml_job_comms&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 4,
</span><span class="boring">   &quot;max&quot;: 2048,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;1m&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;snapshot&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 1,
</span><span class="boring">   &quot;max&quot;: 1,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;5m&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;search_throttled&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: 100
</span><span class="boring"> }
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">MZABTmcQSG3PvMWtK_Sjg&quot;: {
</span><span class="boring">&quot;name&quot;: &quot;tiebreaker-0000000002&quot;,
</span><span class="boring">&quot;transport_address&quot;: &quot;10.42.5.215:19463&quot;,
</span><span class="boring">&quot;host&quot;: &quot;10.42.5.215&quot;,
</span><span class="boring">&quot;ip&quot;: &quot;10.42.5.215&quot;,
</span><span class="boring">&quot;version&quot;: &quot;8.3.1&quot;,
</span><span class="boring">&quot;build_flavor&quot;: &quot;default&quot;,
</span><span class="boring">&quot;build_type&quot;: &quot;docker&quot;,
</span><span class="boring">&quot;build_hash&quot;: &quot;b9a6b2867996ba92ceac66cb5bafc6db25e7910e&quot;,
</span><span class="boring">&quot;roles&quot;: [
</span><span class="boring"> &quot;master&quot;,
</span><span class="boring"> &quot;voting_only&quot;
</span><span class="boring">],
</span><span class="boring">&quot;attributes&quot;: {
</span><span class="boring"> &quot;logical_availability_zone&quot;: &quot;tiebreaker&quot;,
</span><span class="boring"> &quot;availability_zone&quot;: &quot;us-central1-c&quot;,
</span><span class="boring"> &quot;server_name&quot;: &quot;tiebreaker-0000000002.a2ff16d9aa2645dc87ab1714e6e16a84&quot;,
</span><span class="boring"> &quot;xpack.installed&quot;: &quot;true&quot;,
</span><span class="boring"> &quot;data&quot;: &quot;hot&quot;,
</span><span class="boring"> &quot;instance_configuration&quot;: &quot;gcp.es.master.n2.68x32x45&quot;,
</span><span class="boring"> &quot;region&quot;: &quot;unknown-region&quot;
</span><span class="boring">},
</span><span class="boring">&quot;thread_pool&quot;: {
</span><span class="boring"> &quot;force_merge&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;search_coordination&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: 1000
</span><span class="boring"> },
</span><span class="boring"> &quot;searchable_snapshots_cache_fetch_async&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 0,
</span><span class="boring">   &quot;max&quot;: 6,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;30s&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;ml_datafeed&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 1,
</span><span class="boring">   &quot;max&quot;: 512,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;1m&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;snapshot_meta&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 1,
</span><span class="boring">   &quot;max&quot;: 6,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;30s&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;fetch_shard_started&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 1,
</span><span class="boring">   &quot;max&quot;: 4,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;5m&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;rollup_indexing&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;search&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 4,
</span><span class="boring">   &quot;queue_size&quot;: 1000
</span><span class="boring"> },
</span><span class="boring"> &quot;cluster_coordination&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;security-crypto&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: 1000
</span><span class="boring"> },
</span><span class="boring"> &quot;ccr&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 32,
</span><span class="boring">   &quot;queue_size&quot;: 100
</span><span class="boring"> },
</span><span class="boring"> &quot;flush&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 1,
</span><span class="boring">   &quot;max&quot;: 1,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;5m&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;fetch_shard_store&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 1,
</span><span class="boring">   &quot;max&quot;: 4,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;5m&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;ml_utility&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 1,
</span><span class="boring">   &quot;max&quot;: 2048,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;10m&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;get&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 2,
</span><span class="boring">   &quot;queue_size&quot;: 1000
</span><span class="boring"> },
</span><span class="boring"> &quot;system_read&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: 2000
</span><span class="boring"> },
</span><span class="boring"> &quot;system_critical_read&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: 2000
</span><span class="boring"> },
</span><span class="boring"> &quot;write&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 2,
</span><span class="boring">   &quot;queue_size&quot;: 10000
</span><span class="boring"> },
</span><span class="boring"> &quot;watcher&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: 1000
</span><span class="boring"> },
</span><span class="boring"> &quot;security-token-key&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: 1000
</span><span class="boring"> },
</span><span class="boring"> &quot;system_critical_write&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: 1500
</span><span class="boring"> },
</span><span class="boring"> &quot;refresh&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 1,
</span><span class="boring">   &quot;max&quot;: 1,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;5m&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;repository_azure&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 0,
</span><span class="boring">   &quot;max&quot;: 5,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;30s&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;vector_tile_generation&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;system_write&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: 1000
</span><span class="boring"> },
</span><span class="boring"> &quot;generic&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 4,
</span><span class="boring">   &quot;max&quot;: 128,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;30s&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;warmer&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 1,
</span><span class="boring">   &quot;max&quot;: 1,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;5m&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;auto_complete&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: 100
</span><span class="boring"> },
</span><span class="boring"> &quot;azure_event_loop&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 0,
</span><span class="boring">   &quot;max&quot;: 1,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;30s&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;management&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 1,
</span><span class="boring">   &quot;max&quot;: 2,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;5m&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;analyze&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: 16
</span><span class="boring"> },
</span><span class="boring"> &quot;searchable_snapshots_cache_prewarming&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 0,
</span><span class="boring">   &quot;max&quot;: 16,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;30s&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;ml_job_comms&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 4,
</span><span class="boring">   &quot;max&quot;: 2048,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;1m&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;snapshot&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;scaling&quot;,
</span><span class="boring">   &quot;core&quot;: 1,
</span><span class="boring">   &quot;max&quot;: 1,
</span><span class="boring">   &quot;keep_alive&quot;: &quot;5m&quot;,
</span><span class="boring">   &quot;queue_size&quot;: -1
</span><span class="boring"> },
</span><span class="boring"> &quot;search_throttled&quot;: {
</span><span class="boring">   &quot;type&quot;: &quot;fixed&quot;,
</span><span class="boring">   &quot;size&quot;: 1,
</span><span class="boring">   &quot;queue_size&quot;: 100
</span><span class="boring"> }
</span><span class="boring">}
</span>
<span class="boring">}
</span></code></pre></pre>
<p>During the test we indexed into a varying number of shards (2, 4, 8, 16, and 32) using a varying number of concurrent clients (8, 16, 24, 32, 48, and 64) for each cluster. For every combination of shard and client count we indexed 6.4 million documents with a batch size of 100 documents and another 6.4 million documents with a batch size of 200 documents. This means that in total we attempted to index 384 million documents per cluster.</p>
<p>For this test we treat the clusters as a black box, and perform the analysis from the clientâ€™s perspective. To limit the scope we will also not look at the impact of various configurations on performance as that is a quite large topic on its own.</p>
<p>åœ¨æµ‹è¯•ä¸­ï¼Œ</p>
<p>ï¼ˆ1ï¼‰æˆ‘ä»¬å¹¶å‘å†™å…¥è®¾ç½®ä¸åŒçš„å¹¶å‘å®¢æˆ·ç«¯ï¼Œåˆ†åˆ«ä¸º 8/16/24/32/48/64 ä¸ªå®¢æˆ·ç«¯ï¼Œ</p>
<p>ï¼ˆ2ï¼‰ç´¢å¼•åˆ†åˆ«è®¾ç½®ä¸åŒçš„åˆ†ç‰‡æ•°ï¼Œåˆ†åˆ«ä¸º 2/4/8/16/32 ä¸ªåˆ†ç‰‡æ•°ã€‚</p>
<p>ï¼ˆ3ï¼‰æ‰¹é‡å†™å…¥è®¾ç½®ä¸åŒçš„æ–‡æ¡£æ•°ï¼Œåˆ†åˆ«ä¸º 100/200ä¸ªæ–‡æ¡£ï¼Œ</p>
<p>å¯¹äºä¸åŒçš„è®¾ç½®ï¼Œå†™å…¥æ–‡æ¡£æ€»æ•°é‡éƒ½æ˜¯ç›¸åŒçš„ï¼Œæ¯ä¸ªé›†ç¾¤æœ€ç»ˆå°†å†™å…¥æ¥è¿‘4äº¿æ–‡æ¡£ã€‚</p>
<p>åœ¨æ­¤æ¬¡æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬å°†é›†ç¾¤è§†ä¸ºä¸€ä¸ªé»‘ç›’å­ï¼Œå¹¶ä»å®¢æˆ·çš„è§’åº¦è¿›è¡Œåˆ†æã€‚ä¸ºäº†é™åˆ¶èŒƒå›´ï¼Œæˆ‘ä»¬ä¹Ÿä¸ä¼šè€ƒè™‘å„ç§é…ç½®å¯¹äºæ€§èƒ½çš„å½±å“ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„ä¸»é¢˜ã€‚</p>
<p>All the generated, detailed metrics were sent to a separate Elastic Cloud instance for analysis using Kibana. For each request Rally measures how many the documents in the bulk request were rejected and successful. Based on this data we can classify each request as successful, partially rejected, and fully rejected. A few requests also timed out, and these have also been included for completeness.</p>
<p>Unlike Beats and Logstash, Rally does not retry failed indexing requests, so each has the same number of requests executed but the final number of documents indexed varied from run to run depending on the volume of rejections.</p>
<p>æ‰€æœ‰æµ‹è¯•æŒ‡æ ‡ï¼Œéƒ½ä¼šå‘é€åˆ°ä¸€ä¸ªç‹¬ç«‹çš„é›†ç¾¤ï¼Œå¹¶ä¸”ä½¿ç”¨kibanaå¯è§†åŒ–ã€‚å¯¹äºæ¯ä¸ªå®¢æˆ·ç«¯ bulkè¯·æ±‚ï¼Œ<code>rally</code>å¯ä»¥è®°å½•è¯·æ±‚æ˜¯å¦æˆåŠŸï¼Œå¦‚æœå¤±è´¥ï¼Œæ‹’ç»å†™å…¥çš„æ–‡æ¡£æ•°ã€‚æ ¹æ®<code>rally</code>è®°å½•æ•°æ®ï¼Œå¯ä»¥åŒºåˆ†bulkè¯·æ±‚æˆåŠŸ/å®Œå…¨æ‹’ç»/éƒ¨åˆ†æ‹’ç»ã€‚å¦å¤–ï¼Œè¿˜æœ‰ä¸€äº›è¯·æ±‚è¶…æ—¶ï¼Œä¸ºäº†å®Œæ•´æ€§èµ·è§ï¼Œç»Ÿè®¡æ•°æ®ä¹Ÿä¼šåŒ…å«è¶…æ—¶çš„è¯·æ±‚ã€‚</p>
<p>ä¸ beats å’Œ logstashä¸åŒï¼Œ<code>rally</code>å†™å…¥å¤±è´¥ä¸ä¼šé‡è¯•ã€‚å› æ­¤ï¼Œæœ€ç»ˆè½åˆ°ESä¸­æ–‡æ¡£æ•°ä¹Ÿä¼šä¸åŒï¼Œå› ä¸ºæœ‰éƒ¨åˆ†è¯·æ±‚è¢«æ‹’ç»äº†ã€‚</p>
<h2 id="how-bulk-rejection-frequency-depend-on-shard-count-clients-count-and-data-node-count"><a class="header" href="#how-bulk-rejection-frequency-depend-on-shard-count-clients-count-and-data-node-count">How bulk rejection frequency depend on shard count, clients count, and data node count?</a></h2>
<p>bulkå†™å…¥æ‹’ç»é¢‘ç‡å’Œåˆ†ç‰‡æ•°é‡ã€å®¢æˆ·ç«¯å¹¶å‘é‡ã€æ•°æ®èŠ‚ç‚¹æ•°ä¹‹é—´æœ‰ä»€ä¹ˆå…³è”ï¼Ÿ</p>
<p>Bulk rejections occur when the bulk queues fill up. The number of queue slots that get used depends both on the number of concurrent requests, and the number of shards being indexed into. To measure this correlation we have added a calculated metric, client shard concurrency, to each run. This is defined as the number of shards being indexed into, multiplied by the number of concurrent indexing threads, and indicates how many queue slots would be needed to hold all bulk sub-requests.</p>
<p>å½“bulké˜Ÿåˆ—å æ»¡åï¼Œåå…¥çš„bulkè¯·æ±‚å°†è¢«æ‹’ç»ã€‚å†™å…¥è¯·æ±‚ä¼šä½¿ç”¨çš„è¯·æ±‚é˜Ÿåˆ—å¤§å°ï¼Œå–å†³äºå®¢æˆ·ç«¯çš„å¹¶å‘é‡å’Œç´¢å¼•çš„åˆ†ç‰‡æ•°è®¾ç½®ã€‚ä¸ºäº†å‡†ç¡®æè¿°ç›¸å…³æ€§ï¼Œå¼•å…¥ä¸€ä¸ªæ–°çš„æŒ‡æ ‡ï¼Œç§°ä¸ºå®¢æˆ·ç«¯åˆ†ç‰‡å¹¶å‘é‡ = å®¢æˆ·ç«¯å¹¶å‘é‡ * ç´¢å¼•åˆ†ç‰‡æ•°ã€‚</p>
<p><img src="https://github.com/Kua-Fu/blog-book-images/blob/main/elastic/101/bulk-rejection-blog-1.png?raw=true" alt="å®¢æˆ·ç«¯åˆ†ç‰‡å¹¶å‘é‡" /></p>
<p>In the graph below, we show how the percentage of requests that result in partial or full rejections, depends on the client shard concurrency for the three different clusters.</p>
<p>For clusters with one or two nodes we can see that appearance of bulk rejections start when the client shard concurrency level is somewhere between 192 and 256. This makes sense as each node has a bulk queue size of 200. For the cluster with 3 nodes we can see that it is able to handle even higher level of client shard concurrency without any bulk rejections appearing. </p>
<p>Once we get over this limit, we start seeing partial bulk rejections, where at least one sub-request has managed to get queued and processed. A relatively small portion of requests also result on full rejections as the concurrency level increases, especially for the single node cluster. </p>
<p>When we compare the single and two node clusters, we can see that the percentage of fully successful requests increases slightly and that there are fewer full rejections. This is expected, as the total bulk queue across the cluster is twice as large and requests are sent to all data nodes. Even though the total bulk queue size is twice as large across the cluster, the 2 node cluster does not appear able to handle twice the client shard concurrency of the single node cluster. This is likely due to the fact that distribution is not perfect and that the introduction of replica shards have resulted in each indexing operation requiring more work and being slower as a result. An important thing to note is also that all partial rejections are treated as equals in this graph. The number of rejected documents is not shown and does indeed vary depending on the cluster size, but we will shortly look at that in greater detail. </p>
<p>ç”±ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å±•ç¤ºäº†ä¸‰ä¸ªé›†ç¾¤é‡Œé¢ï¼Œä¸åŒç±»å‹å“åº”å æ¯”ï¼ˆå†™å…¥æˆåŠŸ/éƒ¨åˆ†å†™å…¥æˆåŠŸ/å†™å…¥å…¨éƒ¨å¤±è´¥/å†™å…¥è¶…æ—¶ï¼‰ã€‚å¯¹äºå…·æœ‰ä¸€ä¸ªèŠ‚ç‚¹å’Œä¸¤ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå½“å®¢æˆ·ç«¯åˆ†ç‰‡å¹¶å‘é‡è¾¾åˆ° 192ï½256ï¼Œå¼€å§‹å‡ºç°æ‹’ç»è¯·æ±‚ã€‚è¿™ä¸ªæ˜¯æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºæ ¹æ®<code>_nodes/thread_pool/</code>ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„bulké˜Ÿåˆ—å¤§å°ä¸º200ã€‚å¯¹äº3ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œå› ä¸ºå®¢æˆ·ç«¯åˆ†ç‰‡å¹¶å‘é‡æ›´å¤§ï¼Œå¯ä»¥çœ‹åˆ° 192~256 èŒƒå›´å†…ä¸ä¼šå‡ºç°æ‹’ç»è¯·æ±‚ã€‚</p>
<p>è¿˜å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äº3èŠ‚ç‚¹é›†ç¾¤ï¼Œå½“è¾¾åˆ°256é™åˆ¶ä»¥ä¸Šï¼Œå¼€å§‹å‡ºç°éƒ¨åˆ†æ‹’ç»ã€‚å½“å®¢æˆ·ç«¯åˆ†ç‰‡å¹¶å‘é‡ç»§ç»­å¢åŠ åï¼Œå®Œå…¨æ‹’ç»ç±»å‹è¯·æ±‚å¼€å§‹å˜å¤šã€‚</p>
<p>å¦‚æœæˆ‘ä»¬åªæ˜¯æ¯”è¾ƒå•èŠ‚ç‚¹å’ŒåŒèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œå¯ä»¥çœ‹åˆ°åŒèŠ‚ç‚¹é›†ç¾¤ï¼Œå®ŒæˆæˆåŠŸçš„ç™¾åˆ†æ¯”æ›´é«˜ï¼Œå®Œå…¨å¤±è´¥çš„ç™¾åˆ†æ¯”æ›´ä½ã€‚è¿™ä¸ªç»“æœåœ¨æ„æ–™ä¹‹ä¸­ï¼Œå› ä¸ºåŒèŠ‚ç‚¹é›†ç¾¤ï¼Œå¯ä»¥æ¥å—bulkè¯·æ±‚çš„bulké˜Ÿåˆ—æ˜¯å•èŠ‚ç‚¹é›†ç¾¤çš„ä¸¤å€ï¼Œå¹¶ä¸”åŒèŠ‚ç‚¹é›†ç¾¤ï¼Œæœ‰ä¸¤ä¸ªæ•°æ®èŠ‚ç‚¹ï¼Œéƒ½ä¼šæ¥æ”¶bulkè¯·æ±‚ã€‚ä½†æ˜¯ï¼Œä»å›¾ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ï¼ŒåŒèŠ‚ç‚¹é›†ç¾¤çš„å¤„ç†èƒ½åŠ›å¹¶ä¸æ˜¯å•èŠ‚ç‚¹é›†ç¾¤çš„ä¸¤å€ã€‚å¯èƒ½çš„åŸå› å¦‚ä¸‹ï¼š</p>
<p>ï¼ˆ1ï¼‰åˆ†ç‰‡åˆ†å‘ä¸ä¸€å®šæ˜¯å®Œç¾çš„ï¼Œå³ä¸ä¸€å®šï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æ¥æ”¶æ­£å¥½ä¸€åŠçš„bulkè¯·æ±‚ï¼›</p>
<p>ï¼ˆ2ï¼‰å‰¯æœ¬åˆ†ç‰‡çš„è®¾ç½®ï¼Œå¯¼è‡´åŒèŠ‚ç‚¹é›†ç¾¤ï¼Œbulkè¯·æ±‚å¤„ç†æ›´è€—æ—¶ï¼›</p>
<p>ï¼ˆ3ï¼‰éœ€è¦æ³¨æ„åˆ°ï¼Œä¸Šå›¾ä¸­ï¼Œéƒ¨åˆ†è¢«æ‹’ç»çš„è¯·æ±‚ï¼Œå¹¶æ²¡æœ‰è¯¦ç»†çš„è¢«æ‹’ç»æ–‡æ¡£æ•°é‡ï¼Œæˆ‘ä»¬æŠŠæ‰€æœ‰éƒ¨åˆ†è¢«æ‹’ç»è¯·æ±‚å½“ä½œç›¸åŒçš„ç±»å‹ï¼Œå®é™…ä¸Šéƒ¨åˆ†è¢«æ‹’ç»è¯·æ±‚ï¼Œå¯èƒ½åŒ…å«éå¸¸ä¸ä¸€æ ·çš„æ‹’ç»æ–‡æ¡£æ•°é‡ã€‚</p>
<p>å½“ç»§ç»­æŸ¥çœ‹3èŠ‚ç‚¹é›†ç¾¤ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œåªæœ‰å½“å®¢æˆ·ç«¯åˆ†ç‰‡å¹¶å‘é‡åˆ°è¾¾éå¸¸é«˜æ—¶å€™ï¼Œæ‰ä¼šå‡ºç°å®Œå…¨æ‹’ç»è¯·æ±‚ã€‚</p>
<p><img src="https://github.com/Kua-Fu/blog-book-images/blob/main/elastic/101/bulk-rejection-blog-2.png?raw=true" alt="è¯¦ç»†bulkä¿¡æ¯" /></p>
<p>ä¸Šå›¾å±•ç¤ºäº†éƒ¨åˆ†bulkå¤±è´¥çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¸»è¦åŒ…å«äº†bulkå¤±è´¥çš„æ–‡æ¡£æ•°é‡ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äº3ç§ç±»å‹é›†ç¾¤ï¼Œéšç€å®¢æˆ·ç«¯åˆ†ç‰‡å¹¶å‘é‡çš„å¢åŠ ï¼Œè¢«æ‹’ç»çš„æ¯”ä¾‹å˜å¤§ï¼›ä½†æ˜¯éšç€èŠ‚ç‚¹çš„å˜å¤šï¼Œæ‹’ç»çš„çº§åˆ«ï¼ˆå¯ä»¥ä»»åŠ¡æ˜¯æ‹’ç»çš„æ–‡æ¡£æ•°é‡ï¼‰å˜å°ã€‚</p>
<p>å¯¹äºå•èŠ‚ç‚¹é›†ç¾¤ã€åŒèŠ‚ç‚¹é›†ç¾¤ï¼Œéƒ¨åˆ†æ‹’ç»å‡ ä¹åœ¨ç›¸åŒçš„å®¢æˆ·ç«¯åˆ†ç‰‡å¹¶å‘é‡äº§ç”Ÿï¼Œä½†ä¸ç›¸åŒçš„æ˜¯ï¼Œå•èŠ‚ç‚¹é›†ç¾¤è¢«æ‹’ç»æ–‡æ¡£æ•°é‡å¢åŠ çš„æ›´å¿«ã€‚è¿™æ„å‘³ç€ï¼Œå³ä½¿ä¸åŒç±»å‹é›†ç¾¤éƒ½å‘ç”Ÿäº†éƒ¨åˆ†æ‹’ç»è¯·æ±‚ï¼Œæ›´å¤šèŠ‚ç‚¹é›†ç¾¤ï¼Œå®é™…ä¸Šä¼šå†™å…¥æ›´å¤šçš„æ–‡æ¡£ã€‚</p>
<h2 id="cant-i-just-get-around-this-by-increasing-the-bulk-queue-size"><a class="header" href="#cant-i-just-get-around-this-by-increasing-the-bulk-queue-size">Canâ€™t I just get around this by increasing the bulk queue size?</a></h2>
<p>å¯ä»¥é€šè¿‡å¢åŠ bulkè¯·æ±‚é˜Ÿåˆ—é•¿åº¦ï¼Œè§£å†³bulkè¯·æ±‚429é—®é¢˜å—ï¼Ÿ</p>
<p>One of the most common reactions when faced with bulk rejections is to increase the size of the bulk queue. Why not set it to a really large value so you do not have to worry about this again?</p>
<p>Increasing the size of the queue is not likely to improve the indexing performance or throughput of your cluster. Instead it would just make the cluster queue up more data in memory, which is likely to result in bulk requests taking longer to complete. The more bulk requests there are in the queue, the more precious heap space will be consumed. If the pressure on the heap gets too large, it can cause a lot of other performance problems and even cluster instability.</p>
<p>Adjusting the queue sizes is therefore strongly discouraged, as it is like putting a temporary band-aid on the problem rather than actually fixing the underlying issue. So what else can we do improve the situation?</p>
<p>å½“é¢ä¸´bulkè¯·æ±‚è¢«æ‹’ç»åœºæ™¯ï¼Œæœ€å¸¸è§çš„ååº”æ˜¯ä¸ºä»€ä¹ˆä¸å¢åŠ è¯·æ±‚é˜Ÿåˆ—é•¿åº¦ï¼Œè®¾ç½®ä¸€ä¸ªéå¸¸å¤§çš„å€¼ï¼Œè¿™æ ·å°±ä¸ç”¨æ‹…å¿ƒbulkè¯·æ±‚è¢«æ‹’ç»äº†ï¼Ÿ</p>
<p>éœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œå¢åŠ è¯·æ±‚é˜Ÿåˆ—é•¿åº¦ä¸ç­‰äºå¢åŠ ç´¢å¼•çš„æ€§èƒ½å’Œååé‡ã€‚ç›¸åï¼Œå¢åŠ é˜Ÿåˆ—é•¿åº¦ä¼šä½¿å¾—é›†ç¾¤å†…å­˜ä¸­å­˜åœ¨æ›´å¤šæ’é˜Ÿä¸­çš„è¯·æ±‚ï¼Œè¿™æ ·å¯èƒ½å¯¼è‡´bulkè¯·æ±‚ä¼šç»è¿‡æ›´é•¿æ—¶é—´æ‰èƒ½å®Œæˆã€‚è¶Šå¤šçš„bulkè¯·æ±‚ï¼Œè¶Šå¤šå®è´µçš„é›†ç¾¤å †å†…å­˜å°±ä¼šè¢«æ¶ˆè€—ã€‚å¦‚æœå †å†…å­˜å ç”¨è¿‡å¤§ï¼Œå¯èƒ½ä¼šå¯¼è‡´å…¶ä»–çš„æ€§èƒ½é—®é¢˜ï¼Œç”šè‡³è®©é›†ç¾¤å˜å¾—ä¸ç¨³å®šã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®ä¸è¦è°ƒæ•´é˜Ÿåˆ—å¤§å°ï¼Œå› ä¸ºé€šå¸¸æ”¹å˜é˜Ÿåˆ—é•¿åº¦åªä¼šä¸´æ—¶æ”¹å˜è¢«æ‹’ç»è¯·æ±‚æ•°é‡ï¼Œä½†æ˜¯ä¸ä¼šæ ¹æœ¬ä¸Šæ”¹å˜bulkè¯·æ±‚è¢«æ‹’ç»é—®é¢˜ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•åšï¼Œæ ¹æœ¬ä¸Šè§£å†³é—®é¢˜å‘¢ï¼Ÿ</p>
<h2 id="can-coordinating-only-nodes-help"><a class="header" href="#can-coordinating-only-nodes-help">Can coordinating only nodes help?</a></h2>
<p>ä¸“æœ‰åè°ƒèŠ‚ç‚¹ä¼šæœ‰å¸®åŠ©å—ï¼Ÿ</p>
<p>By introducing coordinating only nodes, the data nodes will be able to focus on processing sub-requests, as the request itself will not take up a slot on their bulk queue. This is generally good, but the actual benefit of this arrangement is likely to vary from use-case to use-case. In many use cases it does relatively little difference, and we see lots of successful indexing heavy use cases that do not use dedicated coordinating nodes.</p>
<p>é€šè¿‡å¼•å…¥ä¸“æœ‰åè°ƒèŠ‚ç‚¹ï¼Œæ•°æ®èŠ‚ç‚¹å¯ä»¥æ›´åŠ ä¸“æ³¨äºå¤„ç†bulkå­è¯·æ±‚ï¼Œbulkè¯·æ±‚ä¸ä¼šå ç”¨è¯·æ±‚é˜Ÿåˆ—ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¼•å…¥ä¸“æœ‰åè°ƒèŠ‚ç‚¹å¯ä»¥æ”¹å–„bulkè¯·æ±‚è¢«æ‹’ç»é—®é¢˜ï¼Œä½†å®é™…ä¸Šæ˜¯å¦æ”¹å–„ï¼Œè¿˜æ˜¯å› ä¸ºä¸åŒå®é™…ä½¿ç”¨åœºæ™¯ä¼šæœ‰ä¸åŒçš„ç­”æ¡ˆã€‚åœ¨å¾ˆå¤šçš„æ¡ˆä¾‹ä¸­ï¼Œå¼•å…¥ä¸“æœ‰åè°ƒèŠ‚ç‚¹ï¼Œæ”¹å–„å‡ ä¹æ²¡æœ‰å‘ç”Ÿï¼Œæˆ‘ä»¬é‡åˆ°è¿‡å¾ˆå¤šçš„ç´¢å¼•æ•°æ®é‡å¾ˆå¤§çš„é›†ç¾¤ï¼Œæ ¹æœ¬æ²¡æœ‰ä½¿ç”¨ä¸“æœ‰åè°ƒèŠ‚ç‚¹ã€‚</p>
<h2 id="what-conclusions-can-we-draw"><a class="header" href="#what-conclusions-can-we-draw">What conclusions can we draw?</a></h2>
<p>æˆ‘ä»¬å¯ä»¥å¾—å‡ºä»€ä¹ˆç»“è®ºï¼Ÿ</p>
<p>As always, there is not necessarily any good one-size-fits-all solution, and the way to address bulk rejections will vary from use-case to use-case. If you see bulk rejections, try to understand why they are taking place and whether it is a single node or the whole cluster that is affected.</p>
<p>ä¸€å¦‚æ—¢å¾€çš„ï¼Œæˆ‘ä»¬æ— æ³•å¾—åˆ°ä¸€ä¸ªä¸‡èƒ½æ–¹æ³•ï¼Œå¯ä»¥è§£å†³æ‰€æœ‰ä¸åŒåœºæ™¯çš„bulkè¯·æ±‚è¢«æ‹’ç»é—®é¢˜ã€‚ä¸åŒçš„ç”¨æˆ·ä½¿ç”¨åœºæ™¯ï¼Œå¾€å¾€æœ€ç»ˆä½¿ç”¨ä¸åŒçš„è§£å†³æ–¹æ¡ˆã€‚å¦‚æœä½ å‘ç°äº†bulkè¯·æ±‚å¤±è´¥ï¼Œè¯·ï¼ˆ1ï¼‰å°è¯•æ’æŸ¥å‘ç”Ÿæ‹’ç»çš„åŸå› ï¼›ï¼ˆ2ï¼‰æ˜¯å•ä¸ªèŠ‚ç‚¹ã€è¿˜æ˜¯æ•´ä¸ªé›†ç¾¤éƒ½å‘ç”Ÿäº†bulkè¯·æ±‚è¢«æ‹’ç»ã€‚</p>
<p>å¦‚æœæ˜¯æ•´ä¸ªé›†ç¾¤å¤„äºè¿‡è½½çŠ¶æ€ï¼Œè€Œä¸æ˜¯å•ä¸ªèŠ‚ç‚¹æ‰¿æ‹…äº†è¿‡å¤šçš„å†™å…¥å‹åŠ›ï¼Œå¯èƒ½è¦è€ƒè™‘é›†ç¾¤æ‰©å®¹ï¼ˆæ¨ªå‘æ·»åŠ èŠ‚ç‚¹æˆ–è€…çºµå‘å‡çº§é…ç½®ï¼‰ã€‚æ‰©å®¹åï¼Œæ•´ä¸ªé›†ç¾¤bulkè¯·æ±‚é˜Ÿåˆ—çš„æ€»é•¿åº¦å°†å˜å¤§ï¼Œå¯ä»¥æ‰¿æ‹…æ›´å¤šçš„å†™å…¥å‹åŠ›ã€‚å¦‚æœåªæ˜¯ç®€å•æ·»åŠ ç°æœ‰é›†ç¾¤èŠ‚ç‚¹bulkè¯·æ±‚é˜Ÿåˆ—çš„é•¿åº¦ï¼Œå³ä½¿ä¸´æ—¶è§£å†³äº†é—®é¢˜ï¼Œå®é™…ä¸Šåé¢å¯èƒ½ä¼šé¢ä¸´æ›´å¤šçš„å…¶ä»–æ€§èƒ½é—®é¢˜ã€‚</p>
<p>æœ€åï¼Œè¿˜éœ€è¦è®°ä½çš„æ˜¯ï¼Œbulkè¢«æ‹’ç»å¹¶ä¸ä»£è¡¨æ‰€æœ‰çš„æ–‡æ¡£éƒ½å†™å…¥å¤±è´¥ï¼Œç¨‹åºä»£ç ä¸­éœ€è¦è€ƒè™‘åˆ°åªæœ‰ä¸€éƒ¨åˆ†æ–‡æ¡£å†™å…¥å¤±è´¥ï¼Œè¦è€ƒè™‘è¿™ä¸€éƒ¨åˆ†æ–‡æ¡£çš„é‡ä¼ æœºåˆ¶ã€‚å¯ä»¥å‚è€ƒlogstash,beats ä¸­çš„é‡ä¼ é€»è¾‘ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="elasticsearch-æ¥å£æ–‡æ¡£"><a class="header" href="#elasticsearch-æ¥å£æ–‡æ¡£">elasticsearch æ¥å£æ–‡æ¡£</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="åä¸ºäº‘cssç”Ÿå‘½å‘¨æœŸç®¡ç†"><a class="header" href="#åä¸ºäº‘cssç”Ÿå‘½å‘¨æœŸç®¡ç†">åä¸ºäº‘CSSç”Ÿå‘½å‘¨æœŸç®¡ç†</a></h1>
<h2 id="å‚è€ƒ"><a class="header" href="#å‚è€ƒ">å‚è€ƒ</a></h2>
<blockquote>
<p><a href="https://support.huaweicloud.com/css_faq/css_02_0119.html">å¦‚ä½•æ›´æ–°CSSç”Ÿå‘½å‘¨æœŸç­–ç•¥ï¼Ÿ</a></p>
<p><a href="https://opendistro.github.io/for-elasticsearch-docs/docs/im/ism/">opendistro Index State Management</a></p>
</blockquote>
<h2 id="ä¸€ç®€ä»‹"><a class="header" href="#ä¸€ç®€ä»‹">ä¸€ã€ç®€ä»‹</a></h2>
<p>åä¸ºäº‘CSSæœåŠ¡ï¼Œå¯¹åº”çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œä½¿ç”¨<code>aws opendistro</code>å¯¹åº”çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚</p>
<h2 id="äºŒç´¢å¼•çŠ¶æ€ç®¡ç†"><a class="header" href="#äºŒç´¢å¼•çŠ¶æ€ç®¡ç†">äºŒã€ç´¢å¼•çŠ¶æ€ç®¡ç†</a></h2>
<p>If you analyze time-series data, you likely prioritize new data over old data. You might periodically perform certain operations on older indices, such as reducing replica count or deleting them.</p>
<p>Index State Management (ISM) is a plugin that lets you automate these periodic, administrative operations by triggering them based on changes in the index age, index size, or number of documents. Using the ISM plugin, you can define policies that automatically handle index rollovers or deletions to fit your use case.</p>
<p>å¦‚æœåˆ†ææ—¶é—´åºåˆ—æ•°æ®ï¼Œæˆ‘ä»¬å¾€å¾€æ›´ä¹äºåˆ†ææœ€æ–°çš„æ•°æ®ï¼Œç›¸æ¯”è¾ƒäºä¹‹å‰çš„è€æ•°æ®ã€‚ä½ å¯èƒ½ä¼šå¯¹æ—§æ•°æ®è¿›è¡ŒæŸäº›æ“ä½œï¼Œä¾‹å¦‚: ç¼©å°‘å‰¯æœ¬ã€åˆ é™¤è¿‡æœŸæ•°æ®ã€‚</p>
<p>ISMæ˜¯ä¸€ä¸ªæ’ä»¶ï¼Œå®ƒå…è®¸ä½ æ ¹æ®ç´¢å¼•æ—¶é—´ã€ç´¢å¼•å¤§å°ã€ç´¢å¼•æ–‡æ¡£æ•°é‡ï¼Œå»è§¦å‘ä¸€äº›é¢„å…ˆå®šä¹‰çš„ç®¡ç†æ“ä½œï¼Œä»è€Œå®ç°è¿™äº›æ“ä½œçš„è‡ªåŠ¨åŒ–ã€‚é€šè¿‡ISM, å¯ä»¥æ ¹æ®è‡ªå·±å®é™…ä½¿ç”¨åœºæ™¯ï¼Œå®šä¹‰ç´¢å¼•æ»šåŠ¨ã€åˆ é™¤ç­–ç•¥ã€‚</p>
<p>For example, you can define a policy that moves your index into a read_only state after 30 days and then deletes it after a set period of 90 days. You can also set up the policy to send you a notification message when the index is deleted.</p>
<p>You might want to perform an index rollover after a certain amount of time or run a force_merge operation on an index during off-peak hours to improve search performance during peak hours.</p>
<p>ä¾‹å¦‚ï¼šä½ å¯ä»¥å®šä¹‰ä¸€ä¸ªç­–ç•¥ï¼Œåœ¨å†™å…¥æ•°æ®30å¤©åï¼Œå°†ç´¢å¼•è®¾ç½®ä¸ºåªè¯»çŠ¶æ€ï¼Œç„¶åï¼Œåœ¨ç»è¿‡90å¤©åï¼Œåˆ é™¤è¯¥ç´¢å¼•ã€‚ä½ è¿˜å¯ä»¥è®¾ç½®ç­–ç•¥ï¼Œåœ¨åˆ é™¤ç´¢å¼•çš„æ—¶å€™ï¼Œå‘é€ä¸€ä¸ªé€šçŸ¥ä¿¡æ¯ã€‚</p>
<p>ä½ å¯èƒ½å¸Œæœ›åœ¨ä¸€å®šçš„æ—¶é—´åï¼Œæ»šåŠ¨ç´¢å¼•ï¼Œæˆ–è€…åœ¨éå†™å…¥é«˜å³°æœŸï¼Œå¯¹ç´¢å¼•æ‰§è¡Œ<code>force_merge</code>æ“ä½œï¼Œä»è€Œæé«˜ç´¢å¼•æœç´¢æ€§èƒ½ã€‚</p>
<h2 id="ä¸‰åŸºæœ¬æ¦‚å¿µ"><a class="header" href="#ä¸‰åŸºæœ¬æ¦‚å¿µ">ä¸‰ã€åŸºæœ¬æ¦‚å¿µ</a></h2>
<h3 id="31-çŠ¶æ€-states"><a class="header" href="#31-çŠ¶æ€-states">3.1 çŠ¶æ€ states</a></h3>
<p>A state is the description of the status that the managed index is currently in. A managed index can be in only one state at a time. Each state has associated actions that are executed sequentially on entering a state and transitions that are checked after all the actions have been completed.</p>
<p>This table lists the parameters that you can define for a state.</p>
<table><thead><tr><th>Field</th><th>Description</th><th>Type</th><th>Required</th></tr></thead><tbody>
<tr><td>name</td><td>the name of state</td><td>string</td><td>yes</td></tr>
<tr><td>actions</td><td>The actions to execute after entering a state. For more information, see Actions.</td><td>nested list of objects</td><td>yes</td></tr>
<tr><td>transitions</td><td>The next states and the conditions required to transition to those states. If no transitions exist, the policy assumes that itâ€™s complete and can now stop managing the index. For more information, see Transitions.</td><td>nested list of objects</td><td>yes</td></tr>
</tbody></table>
<p>çŠ¶æ€æ˜¯å½“å‰è¢«æ‰˜ç®¡ç´¢å¼•æ‰€å¤„çŠ¶æ€çš„æè¿°ã€‚æ‰˜ç®¡çš„ç´¢å¼•åœ¨æŸä¸ªæ—¶åˆ»åªèƒ½æœ‰ä¸€ç§çŠ¶æ€ï¼Œæ¯ä¸ªçŠ¶æ€ï¼Œéƒ½ä¼šåœ¨è¿›å…¥è¯¥çŠ¶æ€æ—¶å€™ï¼Œæ‰§è¡Œä¸€ç³»åˆ—å…³è”æ“ä½œï¼Œåœ¨æ‰§è¡Œå…³è”æ“ä½œåï¼Œè¿˜ä¼šæœ‰ä¸€ç³»åˆ—çš„æ£€æŸ¥æ“ä½œ, æ£€æŸ¥æ˜¯å¦è¿›å…¥ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚</p>
<p>ä¸‹é¢çš„è¡¨æ ¼ï¼ŒåŒ…å«äº†ä¸€ä¸ªçŠ¶æ€çš„å®šä¹‰:</p>
<table><thead><tr><th>å­—æ®µåç§°</th><th>æè¿°</th><th>å­—æ®µç±»å‹</th><th>æ˜¯å¦å¿…é¡»</th></tr></thead><tbody>
<tr><td>name</td><td>çŠ¶æ€åç§°</td><td>string</td><td>æ˜¯</td></tr>
<tr><td>actions</td><td>è¿›å…¥çŠ¶æ€åï¼Œéœ€è¦æ‰§è¡Œçš„æ“ä½œ</td><td>nested list of objects</td><td>æ˜¯</td></tr>
<tr><td>transitions</td><td>æ¥ä¸‹æ¥çš„çŠ¶æ€ï¼Œå·²ç»åˆ°è¾¾ä¸‹ä¸€ä¸ªçŠ¶æ€çš„æ¡ä»¶ï¼Œå¦‚æœè¯¥å­—æ®µä¸ºç©ºå€¼ï¼Œåˆ™è¡¨ç¤ºè¯¥çŠ¶æ€æ˜¯ç´¢å¼•æœ€ç»ˆçŠ¶æ€ï¼Œç´¢å¼•åˆ°è¾¾è¯¥çŠ¶æ€ä¸ä¼šè¿›è¡Œç´¢å¼•ç®¡ç†</td><td>nested list of objects</td><td>æ˜¯</td></tr>
</tbody></table>
<h3 id="32-æ“ä½œ-actions"><a class="header" href="#32-æ“ä½œ-actions">3.2 æ“ä½œ actions</a></h3>
<p>Actions are the steps that the policy sequentially executes on entering a specific state.</p>
<p>They are executed in the order in which they are defined.</p>
<p>This table lists the parameters that you can define for an action.</p>
<table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Required</th><th>Default</th></tr></thead><tbody>
<tr><td>timeout</td><td>The timeout period for the action. Accepts time units for minutes, hours, and days.</td><td>time unit</td><td>No</td><td>-</td></tr>
<tr><td>retry</td><td>The retry configuration for the action.</td><td>object</td><td>No</td><td>Specific to action</td></tr>
</tbody></table>
<p>The retry operation has the following parameters:</p>
<table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Required</th><th>Default</th></tr></thead><tbody>
<tr><td>count</td><td>The number of retry counts.</td><td>number</td><td>Yes</td><td>-</td></tr>
<tr><td>backoff</td><td>The backoff policy type to use when retrying.</td><td>string</td><td>No</td><td>Exponential</td></tr>
<tr><td>delay</td><td>The time to wait between retries. Accepts time units for minutes, hours, and days.</td><td>time unit</td><td>No</td><td>1 minute</td></tr>
</tbody></table>
<p>æ“ä½œæ˜¯ç´¢å¼•è¿›å…¥æŸä¸ªçŠ¶æ€åï¼Œéœ€è¦è¿è¡Œçš„ä¸€ç³»åˆ—æ“ä½œã€‚</p>
<p>æ“ä½œéœ€è¦æŒ‰ç…§é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚ä¸‹é¢çš„è¡¨æ ¼ï¼ŒåŒ…å«äº†ä¸€ä¸ªæ“ä½œçš„å®šä¹‰ï¼š</p>
<p>The following example action has a timeout period of one hour. The policy retries this action three times with an exponential backoff policy, with a delay of 10 minutes between each retry:</p>
<p>ä¸‹é¢ç¤ºä¾‹æ“ä½œçš„è¶…æ—¶æ—¶é—´ä¸º1ä¸ªå°æ—¶ï¼Œè¯¥æ“ä½œå¦‚æœå¤±è´¥ï¼Œä¼šä½¿ç”¨æŒ‡æ•°ç­–ç•¥é‡è¯•æœºåˆ¶ï¼Œæ¯æ¬¡é‡è¯•çš„å»¶è¿Ÿä¸º10åˆ†é’Ÿ</p>
<pre><code class="language-json">
&quot;actions&quot;: {
  &quot;timeout&quot;: &quot;1h&quot;,
  &quot;retry&quot;: {
    &quot;count&quot;: 3,
    &quot;backoff&quot;: &quot;exponential&quot;,
    &quot;delay&quot;: &quot;10m&quot;
  }
}

</code></pre>
<h3 id="33-è½¬æ¢-transitions"><a class="header" href="#33-è½¬æ¢-transitions">3.3 è½¬æ¢ transitions</a></h3>
<p>Transitions define the conditions that need to be met for a state to change. After all actions in the current state are completed, the policy starts checking the conditions for transitions.</p>
<p>Transitions are evaluated in the order in which they are defined. For example, if the conditions for the first transition are met, then this transition takes place and the rest of the transitions are dismissed.</p>
<p>è½¬æ¢å®šä¹‰äº†çŠ¶æ€ä¿®æ”¹æ‰€éœ€è¦æ»¡è¶³çš„æ¡ä»¶ï¼Œå½“å‰çŠ¶æ€ä¸‹æ‰€æœ‰çš„ <code>actions</code>éƒ½æ‰§è¡Œå®Œæˆåï¼Œè¿›å…¥åˆ°è½¬æ¢æ¡ä»¶çš„æ£€æŸ¥ã€‚</p>
<p>è½¬æ¢æŒ‰ç…§å®šä¹‰çš„é¡ºåºè¿›è¡Œæ£€æŸ¥ï¼Œä¾‹å¦‚ï¼šæ»¡è¶³äº†å®šä¹‰ä¸­çš„ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼Œåˆ™è½¬æ¢ä¼šè¿›è¡Œï¼›ä¼šå¿½ç•¥å…¶ä»–çš„æ¡ä»¶ã€‚</p>
<p>If you donâ€™t specify any conditions in a transition and leave it empty, then itâ€™s assumed to be the equivalent of always true. This means that the policy transitions the index to this state the moment it checks.</p>
<p>This table lists the parameters you can define for transitions.</p>
<p>å¦‚æœå®šä¹‰ä¸­æ²¡æœ‰æŒ‡å®šä»»ä½•æ¡ä»¶ï¼Œåˆ™ç­‰åŒäº<code>always true</code>ï¼Œåœ¨ç´¢å¼•æ£€æŸ¥æ—¶å€™ï¼Œä¼šè¿›è¡ŒçŠ¶æ€è½¬æ¢ã€‚</p>
<p>ä¸‹é¢çš„è¡¨æ ¼ï¼Œå®šä¹‰äº†è½¬æ¢:</p>
<table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Required</th></tr></thead><tbody>
<tr><td>state_name</td><td>The name of the state to transition to if the conditions are met.</td><td>string</td><td>Yes</td></tr>
<tr><td>conditions</td><td>List the conditions for the transition.</td><td>list</td><td>Yes</td></tr>
</tbody></table>
<p>The conditions object has the following parameters:</p>
<p>|Parameter	Description	Type	Required
min_index_age	The minimum age of the index required to transition.	string	No
min_doc_count	The minimum document count of the index required to transition.	number	No
min_size	The minimum size of the total primary shard storage (not counting replicas). For example, if you set min_size to 100 GiB and your index has 5 primary shards and 5 replica shards of 20 GiB each, the total size of all primary shards is 100 GiB, so your index is transitioned to the next state.	string	No
cron	The cron job that triggers the transition if no other transition happens first.	object	No
cron.cron.expression	The cron expression that triggers the transition.	string	Yes
cron.cron.timezone	The timezone that triggers the transition.	string	Yes</p>
<h3 id="34-ç­–ç•¥-policies"><a class="header" href="#34-ç­–ç•¥-policies">3.4 ç­–ç•¥ policies</a></h3>
<p>Policies are JSON documents that define the following:</p>
<ul>
<li>
<p>The states that an index can be in, including the default state for new indices. For example, you might name your states â€œhot,â€ â€œwarm,â€ â€œdelete,â€ and so on. For more information, see States.</p>
</li>
<li>
<p>Any actions that you want the plugin to take when an index enters a state, such as performing a rollover. For more information, see Actions.</p>
</li>
<li>
<p>The conditions that must be met for an index to move into a new state, known as transitions. For example, if an index is more than eight weeks old, you might want to move it to the â€œdeleteâ€ state. For more information, see Transitions.</p>
</li>
</ul>
<p>In other words, a policy defines the states that an index can be in, the actions to perform when in a state, and the conditions that must be met to transition between states.</p>
<p>ç­–ç•¥æ˜¯ä¸€ä¸ªJSONæ–‡æ¡£ï¼Œé‡Œé¢å®šä¹‰äº†:</p>
<ul>
<li>
<p>çŠ¶æ€ï¼Œç­–ç•¥ä¸­éœ€è¦æŒ‡å®šçŠ¶æ€ï¼Œä¾‹å¦‚ï¼šç´¢å¼•åˆ›å»ºåçš„é»˜è®¤çŠ¶æ€ï¼ŒçŠ¶æ€çš„å¯é€‰å€¼æœ‰ <code>hot/warm/cold</code>ç­‰</p>
</li>
<li>
<p>æ“ä½œï¼Œå½“ç´¢å¼•è¿›å…¥åˆ°æ–°çŠ¶æ€åï¼Œæ‰§è¡Œçš„ä¸€ç³»åˆ—æ“ä½œï¼Œä¾‹å¦‚ï¼šæ»šåŠ¨ç´¢å¼•ç­‰</p>
</li>
<li>
<p>è½¬æ¢ï¼Œç´¢å¼•è¿›å…¥æ–°çŠ¶æ€éœ€è¦æ»¡è¶³çš„æ¡ä»¶ã€‚ä¾‹å¦‚ï¼šä¸€ä¸ªç´¢å¼•ï¼Œè¶…è¿‡8å‘¨ï¼Œå¯èƒ½éœ€è¦å˜æ›´ä¸º delete çŠ¶æ€ã€‚</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="elasticsearché›†ç¾¤å¤‡ä»½"><a class="header" href="#elasticsearché›†ç¾¤å¤‡ä»½">elasticsearché›†ç¾¤å¤‡ä»½</a></h1>
<ul>
<li>
<p><a href="use/backup/./snapshot.html">å¿«ç…§å¤‡ä»½</a></p>
</li>
<li>
<p><a href="use/backup/./meta.html">åªå¤‡ä»½é›†ç¾¤ä¸­çš„ç­–ç•¥ã€æ¨¡ç‰ˆç­‰ä¿¡æ¯</a></p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ä½¿ç”¨å¿«ç…§å¤‡ä»½"><a class="header" href="#ä½¿ç”¨å¿«ç…§å¤‡ä»½">ä½¿ç”¨å¿«ç…§å¤‡ä»½</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="åªå¤‡ä»½é›†ç¾¤ä¸­çš„ç­–ç•¥æ¨¡ç‰ˆç­‰ä¿¡æ¯"><a class="header" href="#åªå¤‡ä»½é›†ç¾¤ä¸­çš„ç­–ç•¥æ¨¡ç‰ˆç­‰ä¿¡æ¯">åªå¤‡ä»½é›†ç¾¤ä¸­çš„ç­–ç•¥ã€æ¨¡ç‰ˆç­‰ä¿¡æ¯</a></h1>
<h2 id="å‚è€ƒ-1"><a class="header" href="#å‚è€ƒ-1">å‚è€ƒ</a></h2>
<blockquote>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-put-user.html">ç”¨æˆ·ç®¡ç†</a></p>
</blockquote>
<blockquote>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.3/cluster-update-settings.html">é›†ç¾¤é…ç½®</a></p>
</blockquote>
<blockquote>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.3/data-management.html">ç­–ç•¥ç®¡ç†</a></p>
</blockquote>
<blockquote>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.3/index-templates.html">æ¨¡ç‰ˆç®¡ç†</a></p>
</blockquote>
<h2 id="ä¸€é›†ç¾¤é…ç½®"><a class="header" href="#ä¸€é›†ç¾¤é…ç½®">ä¸€ã€é›†ç¾¤é…ç½®</a></h2>
<h3 id="11-ä»ç°æœ‰é›†ç¾¤è·å–é›†ç¾¤é…ç½®"><a class="header" href="#11-ä»ç°æœ‰é›†ç¾¤è·å–é›†ç¾¤é…ç½®">1.1 ä»ç°æœ‰é›†ç¾¤è·å–é›†ç¾¤é…ç½®</a></h3>
<pre><code>
GET _cluster/settings?flat_settings

curl -u elastic:xxx -XGET &quot;http://127.0.0.1:9200/_cluster/settings?flat_settings&quot;

</code></pre>
<p>è¿”å›å€¼å¦‚ä¸‹:</p>
<pre><code class="language-json">
{
  &quot;persistent&quot; : {
    &quot;action.auto_create_index&quot; : &quot;+.*,-*&quot;,
    &quot;action.destructive_requires_name&quot; : &quot;false&quot;,
    &quot;cluster.max_shards_per_node&quot; : &quot;5000&quot;,
    &quot;xpack.monitoring.collection.enabled&quot; : &quot;true&quot;
  },
  &quot;transient&quot; : { }
}

</code></pre>
<h3 id="12-å°†é›†ç¾¤é…ç½®å¯¼å…¥åˆ°æ–°é›†ç¾¤"><a class="header" href="#12-å°†é›†ç¾¤é…ç½®å¯¼å…¥åˆ°æ–°é›†ç¾¤">1.2 å°†é›†ç¾¤é…ç½®å¯¼å…¥åˆ°æ–°é›†ç¾¤</a></h3>
<pre><code>
PUT _cluster/settings
{
  &quot;persistent&quot; : {
    &quot;action.auto_create_index&quot; : &quot;+.*,-*&quot;,
    &quot;action.destructive_requires_name&quot; : &quot;false&quot;,
    &quot;cluster.max_shards_per_node&quot; : &quot;5000&quot;,
    &quot;xpack.monitoring.collection.enabled&quot; : &quot;true&quot;
  },
  &quot;transient&quot; : { }
}

curl -u elastic:xxx -XPUT &quot;http://127.0.0.l:9200/_cluster/settings&quot; -H 'Content-Type: application/json' -d'{  &quot;persistent&quot; : {    &quot;action.auto_create_index&quot; : &quot;+.*,-*&quot;,    &quot;action.destructive_requires_name&quot; : &quot;false&quot;,    &quot;cluster.max_shards_per_node&quot; : &quot;5000&quot;,    &quot;xpack.monitoring.collection.enabled&quot; : &quot;true&quot;  },  &quot;transient&quot; : { }}'

</code></pre>
<h2 id="äºŒç´¢å¼•ç­–ç•¥"><a class="header" href="#äºŒç´¢å¼•ç­–ç•¥">äºŒã€ç´¢å¼•ç­–ç•¥</a></h2>
<h3 id="21-ä»ç°æœ‰é›†ç¾¤è·å–ç­–ç•¥ä¿¡æ¯"><a class="header" href="#21-ä»ç°æœ‰é›†ç¾¤è·å–ç­–ç•¥ä¿¡æ¯">2.1 ä»ç°æœ‰é›†ç¾¤è·å–ç­–ç•¥ä¿¡æ¯</a></h3>
<pre><code>
GET _ilm/policy

curl -u elastic:xxx -XGET &quot;http://127.0.0.1:9200/_ilm/policy&quot;

</code></pre>
<p>è¿”å›å€¼å¦‚ä¸‹:</p>
<pre><code class="language-json">
{
  &quot;.items-default&quot; : {
    &quot;version&quot; : 1,
    &quot;modified_date&quot; : &quot;2021-12-30T06:02:12.763Z&quot;,
    &quot;policy&quot; : {
      &quot;phases&quot; : {
        &quot;hot&quot; : {
          &quot;min_age&quot; : &quot;0ms&quot;,
          &quot;actions&quot; : {
            &quot;rollover&quot; : {
              &quot;max_size&quot; : &quot;50gb&quot;
            }
          }
        }
      }
    }
  }
  ...
}

</code></pre>
<h3 id="22-å°†ç­–ç•¥ä¿¡æ¯å¯¼å…¥åˆ°æ–°é›†ç¾¤"><a class="header" href="#22-å°†ç­–ç•¥ä¿¡æ¯å¯¼å…¥åˆ°æ–°é›†ç¾¤">2.2 å°†ç­–ç•¥ä¿¡æ¯å¯¼å…¥åˆ°æ–°é›†ç¾¤</a></h3>
<p>âš ï¸ ä¸€æ¬¡åªèƒ½å¯¼å…¥ä¸€ä¸ªç­–ç•¥, PUT body ä¸éœ€è¦ version/modified_date ä¿¡æ¯</p>
<pre><code>
PUT _ilm/policy/.items-default
{
  &quot;policy&quot;: {
    &quot;phases&quot;: {
      &quot;hot&quot;: {
        &quot;min_age&quot;: &quot;0ms&quot;,
        &quot;actions&quot;: {
          &quot;rollover&quot;: {
            &quot;max_size&quot;: &quot;50gb&quot;
          }
        }
      }
    }
  }
}

curl -u elastic:xxx -XPUT &quot;http://127.0.0.1:9200/_ilm/policy/.items-default&quot; -H 'Content-Type: application/json' -d'{  &quot;policy&quot;: {    &quot;phases&quot;: {      &quot;hot&quot;: {        &quot;min_age&quot;: &quot;0ms&quot;,        &quot;actions&quot;: {          &quot;rollover&quot;: {            &quot;max_size&quot;: &quot;50gb&quot;          }        }      }    }  }}'

</code></pre>
<h2 id="ä¸‰ç´¢å¼•æ¨¡ç‰ˆ"><a class="header" href="#ä¸‰ç´¢å¼•æ¨¡ç‰ˆ">ä¸‰ã€ç´¢å¼•æ¨¡ç‰ˆ</a></h2>
<h3 id="31-ä»ç°æœ‰é›†ç¾¤è·å–ç´¢å¼•æ¨¡ç‰ˆ"><a class="header" href="#31-ä»ç°æœ‰é›†ç¾¤è·å–ç´¢å¼•æ¨¡ç‰ˆ">3.1 ä»ç°æœ‰é›†ç¾¤è·å–ç´¢å¼•æ¨¡ç‰ˆ</a></h3>
<pre><code>
GET _template/*

curl -u elastic:xxx -XGET &quot;http://127.0.0.1:9200/_template/*&quot;

</code></pre>
<p>è¿”å›ç»“æœå¦‚ä¸‹:</p>
<pre><code class="language-json">
{
  &quot;wksp_xxx_template&quot; : {
    &quot;order&quot; : 0,
    &quot;index_patterns&quot; : [
      &quot;wksp_xxx-*&quot;
    ],
    &quot;settings&quot; : {
      &quot;index&quot; : {
        &quot;lifecycle&quot; : {
          &quot;name&quot; : &quot;es_rp4&quot;,
          &quot;rollover_alias&quot; : &quot;wksp_xxx&quot;
        },
        &quot;number_of_shards&quot; : &quot;1&quot;,
        &quot;number_of_replicas&quot; : &quot;1&quot;
      }
    },
    &quot;mappings&quot; : {
      &quot;dynamic_templates&quot; : [
        {
          &quot;strings_as_keywords&quot; : {
            &quot;mapping&quot; : {
              &quot;type&quot; : &quot;keyword&quot;
            },
            &quot;match_mapping_type&quot; : &quot;string&quot;
          }
        }
      ],
      &quot;date_detection&quot; : false,
      &quot;properties&quot; : {
        &quot;message&quot; : {
          &quot;search_analyzer&quot; : &quot;ik_max_word&quot;,
          &quot;search_quote_analyzer&quot; : &quot;ik_max_word&quot;,
          &quot;analyzer&quot; : &quot;ik_max_word&quot;,
          &quot;type&quot; : &quot;text&quot;
        },
        &quot;title&quot; : {
          &quot;search_analyzer&quot; : &quot;ik_max_word&quot;,
          &quot;search_quote_analyzer&quot; : &quot;ik_max_word&quot;,
          &quot;analyzer&quot; : &quot;ik_max_word&quot;,
          &quot;type&quot; : &quot;text&quot;
        }
      }
    },
    &quot;aliases&quot; : { }
  }
  
  ...
}

</code></pre>
<h3 id="32-å°†ç´¢å¼•æ¨¡ç‰ˆå¯¼å…¥åˆ°æ–°é›†ç¾¤"><a class="header" href="#32-å°†ç´¢å¼•æ¨¡ç‰ˆå¯¼å…¥åˆ°æ–°é›†ç¾¤">3.2 å°†ç´¢å¼•æ¨¡ç‰ˆå¯¼å…¥åˆ°æ–°é›†ç¾¤</a></h3>
<p>âš ï¸ ä¸€æ¬¡åªèƒ½å¯¼å…¥ä¸€ä¸ªæ¨¡ç‰ˆ</p>
<pre><code>
PUT _template/wksp_xxx_template
{
  &quot;order&quot;: 0,
  &quot;index_patterns&quot;: [
    &quot;wksp_xxx-*&quot;
  ],
  &quot;settings&quot;: {
    &quot;index&quot;: {
      &quot;lifecycle&quot;: {
        &quot;name&quot;: &quot;es_rp4&quot;,
        &quot;rollover_alias&quot;: &quot;wksp_xxx&quot;
      },
      &quot;number_of_shards&quot;: &quot;1&quot;,
      &quot;number_of_replicas&quot;: &quot;1&quot;
    }
  },
  &quot;mappings&quot;: {
    &quot;dynamic_templates&quot;: [
      {
        &quot;strings_as_keywords&quot;: {
          &quot;mapping&quot;: {
            &quot;type&quot;: &quot;keyword&quot;
          },
          &quot;match_mapping_type&quot;: &quot;string&quot;
        }
      }
    ],
    &quot;date_detection&quot;: false,
    &quot;properties&quot;: {
      &quot;message&quot;: {
        &quot;search_analyzer&quot;: &quot;ik_max_word&quot;,
        &quot;search_quote_analyzer&quot;: &quot;ik_max_word&quot;,
        &quot;analyzer&quot;: &quot;ik_max_word&quot;,
        &quot;type&quot;: &quot;text&quot;
      },
      &quot;title&quot;: {
        &quot;search_analyzer&quot;: &quot;ik_max_word&quot;,
        &quot;search_quote_analyzer&quot;: &quot;ik_max_word&quot;,
        &quot;analyzer&quot;: &quot;ik_max_word&quot;,
        &quot;type&quot;: &quot;text&quot;
      }
    }
  },
  &quot;aliases&quot;: {}
}

curl -u elastic:xxx -XPUT &quot;http://127.0.0.1:9200/_template/wksp_xxx_template&quot; -H 'Content-Type: application/json' -d'{  &quot;order&quot;: 0,  &quot;index_patterns&quot;: [    &quot;wksp_xxx-*&quot;  ],  &quot;settings&quot;: {    &quot;index&quot;: {      &quot;lifecycle&quot;: {        &quot;name&quot;: &quot;es_rp4&quot;,        &quot;rollover_alias&quot;: &quot;wksp_xxx&quot;      },      &quot;number_of_shards&quot;: &quot;1&quot;,      &quot;number_of_replicas&quot;: &quot;1&quot;    }  },  &quot;mappings&quot;: {    &quot;dynamic_templates&quot;: [      {        &quot;strings_as_keywords&quot;: {          &quot;mapping&quot;: {            &quot;type&quot;: &quot;keyword&quot;          },          &quot;match_mapping_type&quot;: &quot;string&quot;        }      }    ],    &quot;date_detection&quot;: false,    &quot;properties&quot;: {      &quot;message&quot;: {        &quot;search_analyzer&quot;: &quot;ik_max_word&quot;,        &quot;search_quote_analyzer&quot;: &quot;ik_max_word&quot;,        &quot;analyzer&quot;: &quot;ik_max_word&quot;,        &quot;type&quot;: &quot;text&quot;      },      &quot;title&quot;: {        &quot;search_analyzer&quot;: &quot;ik_max_word&quot;,        &quot;search_quote_analyzer&quot;: &quot;ik_max_word&quot;,        &quot;analyzer&quot;: &quot;ik_max_word&quot;,        &quot;type&quot;: &quot;text&quot;      }    }  },  &quot;aliases&quot;: {}}'

</code></pre>
<h2 id="å››ç”¨æˆ·"><a class="header" href="#å››ç”¨æˆ·">å››ã€ç”¨æˆ·</a></h2>
<p>elasticsearch æ— æ³•é€šè¿‡æ¥å£ï¼Œè·å–ç”¨æˆ·å¯†ç ï¼Œä¹Ÿå°±ä¸å­˜åœ¨ç”¨æˆ·å¯†ç å¤‡ä»½</p>
<p>å¦‚æœéœ€è¦åœ¨æ–°é›†ç¾¤æ·»åŠ ç”¨æˆ·ï¼Œæˆ–è€…é‡ç½®ï¼ˆå†…ç½®ç”¨æˆ·ï¼‰å¯†ç ï¼Œå¯ä»¥ä½¿ç”¨ <code>POST /_security/user/username</code> </p>
<pre><code>POST /_security/user/jacknich
{
  &quot;password&quot; : &quot;l0ng-r4nd0m-p@ssw0rd&quot;,
  &quot;roles&quot; : [ &quot;admin&quot;, &quot;other_role1&quot; ],
  &quot;full_name&quot; : &quot;Jack Nicholson&quot;,
  &quot;email&quot; : &quot;jacknich@example.com&quot;,
  &quot;metadata&quot; : {
    &quot;intelligence&quot; : 7
  }
}

</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="reindex-è¿‡ç¨‹"><a class="header" href="#reindex-è¿‡ç¨‹">reindex è¿‡ç¨‹</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="reindexæ·»åŠ æ–°å­—æ®µ"><a class="header" href="#reindexæ·»åŠ æ–°å­—æ®µ">reindexæ·»åŠ æ–°å­—æ®µ</a></h1>
<blockquote>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-scripting-fields.html#modules-scripting-doc-vals">Accessing document fields and special variables</a></p>
</blockquote>
<p>å‡è®¾æˆ‘ä»¬æƒ³è¦çŸ¥é“ ä¹‹å‰ç´¢å¼•ä¸­çš„æ—¥å¿—å¤§å°ï¼Œ</p>
<p>å¯ä»¥åœ¨reindexé˜¶æ®µï¼Œä½¿ç”¨scriptï¼Œè®¡ç®—æ¯ä¸ªdoc çš„_sourceé•¿åº¦</p>
<pre><code>POST _reindex
{
  &quot;source&quot;: {
    &quot;index&quot;: &quot;yztest-log&quot;
  },
  &quot;dest&quot;: {
    &quot;index&quot;: &quot;yztest-backup&quot;
  },
  &quot;script&quot;: {
    &quot;lang&quot;: &quot;painless&quot;,
    &quot;source&quot;: &quot;&quot;&quot;ctx._source.len = ctx._source.toString().length()&quot;&quot;&quot;
  }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="luceneä»‹ç»"><a class="header" href="#luceneä»‹ç»">luceneä»‹ç»</a></h1>
<h2 id="ä¸€å‚è€ƒ"><a class="header" href="#ä¸€å‚è€ƒ">ä¸€ã€å‚è€ƒ</a></h2>
<blockquote>
<p><a href="https://www.apache.org/">Apache</a></p>
</blockquote>
<blockquote>
<p><a href="https://www.elastic.co/cn/celebrating-lucene">Celebrating 20 years of Apache Lucene</a></p>
</blockquote>
<blockquote>
<p><a href="https://book.douban.com/subject/3726306/">lucene in action, 2rd</a></p>
</blockquote>
<blockquote>
<p><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/foreword_id.html">Elasticsearch: æƒå¨æŒ‡å—</a></p>
</blockquote>
<blockquote>
<p><a href="https://learning.oreilly.com/library/view/practical-apache-lucene/9781484263457/">Practical Apache Lucene 8: Uncover the Search Capabilities of Your Application</a></p>
</blockquote>
<blockquote>
<p><a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/codecs/lucene90/package-summary.html">Lucene 9.0 file format</a></p>
</blockquote>
<blockquote>
<p><a href="http://ddia.vonng.com/#/ch3?id=sstables%e5%92%8clsm%e6%a0%91">è®¾è®¡æ•°æ®å¯†é›†å‹åº”ç”¨-å­˜å‚¨ä¸æ£€ç´¢</a></p>
</blockquote>
<blockquote>
<p><a href="https://mp.weixin.qq.com/s/BsW_SeGdnMHfg1_bM_sgSQ">å­˜å‚¨ç³»ç»Ÿä¸­çš„ç®—æ³•ï¼šLSM æ ‘è®¾è®¡åŸç†</a></p>
</blockquote>
<blockquote>
<p><a href="https://mp.weixin.qq.com/s/GsnBpZPzizX9ODuQLT-uAg">LSMæ ¸å¿ƒå®ç°è®²è§£</a></p>
</blockquote>
<blockquote>
<p><a href="https://github.com/facebook/rocksdb/wiki/RocksDB-Overview">RocksDB</a></p>
</blockquote>
<blockquote>
<p><a href="https://zhuanlan.zhihu.com/p/354105864">Lucene-æ–‡ä»¶æ ¼å¼</a></p>
</blockquote>
<blockquote>
<p><a href="https://blog.mikemccandless.com/2010/12/using-finite-state-transducers-in.html">Using Finite State Transducers in Lucene</a></p>
</blockquote>
<blockquote>
<p><a href="https://www.easyice.cn/archives/346">Elasticsearch 7.3 çš„ offheap åŸç†</a></p>
</blockquote>
<blockquote>
<p><a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/search/similarities/Similarity.html">Similarity</a></p>
</blockquote>
<h2 id="ä¸€lucene-åˆè¯†"><a class="header" href="#ä¸€lucene-åˆè¯†">ä¸€ã€lucene åˆè¯†</a></h2>
<h3 id="11-lucene-æ˜¯ä»€ä¹ˆ"><a class="header" href="#11-lucene-æ˜¯ä»€ä¹ˆ">1.1 lucene æ˜¯ä»€ä¹ˆï¼Ÿ</a></h3>
<ul>
<li>
<p>lucene æ˜¯ä¸ª Java æœç´¢åº“ï¼Œ<a href="https://lucene.apache.org/core/">ç®€å•æ˜“ç”¨ï¼ŒåŠŸèƒ½å¼ºå¤§</a></p>
</li>
<li>
<p>lucene å’Œ Elasticsearch å…³ç³»ï¼Œå¯ä»¥ç±»æ¯”ä¸º å‘åŠ¨æœºå’Œæ±½è½¦å…³ç³»ï¼Œluceneæä¾›å†™å…¥/æŸ¥è¯¢æ ¸å¿ƒåŠŸèƒ½ï¼ŒESå®ç°åˆ†å¸ƒå¼/åˆ†æåŠŸèƒ½ã€‚</p>
</li>
<li>
<p>lucene å’Œ google ç­‰æœç´¢å…¬å¸å…³ç³»ï¼Œ</p>
<p>lucene æ˜¯å¼€æºè½¯ä»¶ï¼Œå¯ä»¥å…è´¹ä½¿ç”¨ï¼›googleå…¬å¸çš„æœç´¢åŠŸèƒ½éœ€è¦ä»˜è´¹</p>
<p>å®ƒä»¬ä¹‹é—´çš„æœç´¢èƒ½åŠ›ä¸å¤ªå¥½æ¯”è¾ƒï¼Œluceneç»è¿‡å¤šå¹´å‘å±•ï¼Œå·²ç»æˆä¸ºä¿¡æ¯æ£€ç´¢é¢†åŸŸçš„å¼€æºè½¯ä»¶æ ‡å‡†</p>
</li>
<li>
<p>lucene ä¸å…³ç³»å‹æ•°æ®åº“çš„åŒºåˆ«</p>
<p>luceneåŸºäºæ–‡æ¡£ç´¢å¼•å’Œæœç´¢ï¼Œä¸€èˆ¬ç”¨äºå…¨æ–‡æœç´¢ï¼Œæ— æ³•å®ç°äº‹åŠ¡</p>
</li>
<li>
<p>åŸºäºluceneï¼Œå®ç°æœç´¢åŠŸèƒ½çš„å…¬å¸æˆ–è€…äº§å“æœ‰ï¼Œgithub/ wiki/ twitter/ linkedin ç­‰ç­‰</p>
</li>
</ul>
<h3 id="12-å‘å±•å†ç¨‹"><a class="header" href="#12-å‘å±•å†ç¨‹">1.2 å‘å±•å†ç¨‹</a></h3>
<p><img src="https://github.com/Kua-Fu/blog-book-images/blob/main/elastic-101/lucene/cloudera-doug-cutting.png?raw=true" alt="Doug" /></p>
<h4 id="1--2000å¹´3æœˆdoug-cutting-ç¬¬ä¸€æ¬¡å‘å¸ƒå¼€æºç‰ˆæœ¬-001"><a class="header" href="#1--2000å¹´3æœˆdoug-cutting-ç¬¬ä¸€æ¬¡å‘å¸ƒå¼€æºç‰ˆæœ¬-001">ï¼ˆ1ï¼‰  2000å¹´3æœˆï¼Œ<a href="https://en.wikipedia.org/wiki/Doug_Cutting">Doug Cutting</a> ç¬¬ä¸€æ¬¡å‘å¸ƒå¼€æºç‰ˆæœ¬ 0.01</a></h4>
<ul>
<li>
<p>1997å¹´ï¼ŒDoug å› ä¸ºå·¥ä½œä¸ç¨³å®šå’Œ Java å½“æ—¶éå¸¸çƒ­é—¨ï¼Œæ‰€ä»¥ï¼Œä»–æƒ³åˆ©ç”¨ Java å•†ä¸šåŒ–ä¸€äº›è‡ªå·±çš„è½¯ä»¶ï¼Œä½†æ˜¯åæ¥æ”¾å¼ƒå•†ä¸šåŒ–æƒ³æ³•ï¼Œå°† lucene æ”¾åˆ° SourceForge ä¸Šå¼€æºï¼Œ Dougæ›¾ç»æ˜¯ Apache åŸºé‡‘ä¼šä¸»å¸­ï¼ˆ2011å¹´ï¼‰</p>
</li>
<li>
<p>lucene æ˜¯ Doug çš„ç¬¬äº”ä¸ªæœç´¢å¼•æ“ï¼Œä¹‹å‰åœ¨æ–½ä¹PARCå†™è¿‡ä¸¤ä¸ªï¼Œä¸€ä¸ªåœ¨è‹¹æœï¼Œä¸€ä¸ªåœ¨Excite</p>
</li>
<li>
<p>lucene æ˜¯ Doug è€å©†ä¸­é—´çš„åå­—</p>
</li>
</ul>
<h4 id="2-2000å¹´10æœˆå‘å¸ƒ-10"><a class="header" href="#2-2000å¹´10æœˆå‘å¸ƒ-10">ï¼ˆ2ï¼‰ 2000å¹´10æœˆï¼Œå‘å¸ƒ 1.0</a></h4>
<ul>
<li>
<p>2001å¹´9æœˆï¼Œlucene åŠ å…¥ <a href="https://jakarta.apache.org/">Apache Jakarta</a> é¡¹ç›®</p>
</li>
<li>
<p>2002å¹´ï¼Œ1.2ç‰ˆæœ¬æˆä¸ºç¬¬ä¸€ä¸ª Apache è®¸å¯è¯çš„ lucene ç‰ˆæœ¬</p>
</li>
<li>
<p>2004å¹´ï¼Œ<a href="https://en.wikipedia.org/wiki/Elasticsearch">Shay Banon</a> å‘å¸ƒäº†Elasticsearchçš„å‰èº«-<a href="http://www.compass-project.org/overview.html">compass</a></p>
</li>
</ul>
<blockquote>
<p>è®¸å¤šå¹´å‰ï¼Œä¸€ä¸ªåˆšç»“å©šçš„åå« Shay Banon çš„å¤±ä¸šå¼€å‘è€…ï¼Œè·Ÿç€ä»–çš„å¦»å­å»äº†ä¼¦æ•¦ï¼Œä»–çš„å¦»å­åœ¨é‚£é‡Œå­¦ä¹ å¨å¸ˆã€‚ åœ¨å¯»æ‰¾ä¸€ä¸ªèµšé’±çš„å·¥ä½œçš„æ—¶å€™ï¼Œä¸ºäº†ç»™ä»–çš„å¦»å­åšä¸€ä¸ªé£Ÿè°±æœç´¢å¼•æ“ï¼Œä»–å¼€å§‹ä½¿ç”¨ Lucene çš„ä¸€ä¸ªæ—©æœŸç‰ˆæœ¬ã€‚
ç›´æ¥ä½¿ç”¨ Lucene æ˜¯å¾ˆéš¾çš„ï¼Œå› æ­¤ Shay å¼€å§‹åšä¸€ä¸ªæŠ½è±¡å±‚ï¼ŒJava å¼€å‘è€…ä½¿ç”¨å®ƒå¯ä»¥å¾ˆç®€å•çš„ç»™ä»–ä»¬çš„ç¨‹åºæ·»åŠ æœç´¢åŠŸèƒ½ã€‚ ä»–å‘å¸ƒäº†ä»–çš„ç¬¬ä¸€ä¸ªå¼€æºé¡¹ç›® Compassã€‚</p>
<p>åæ¥ Shay è·å¾—äº†ä¸€ä»½å·¥ä½œï¼Œä¸»è¦æ˜¯é«˜æ€§èƒ½ï¼Œåˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„å†…å­˜æ•°æ®ç½‘æ ¼ã€‚è¿™ä¸ªå¯¹äºé«˜æ€§èƒ½ï¼Œå®æ—¶ï¼Œåˆ†å¸ƒå¼æœç´¢å¼•æ“çš„éœ€æ±‚å°¤ä¸ºçªå‡ºï¼Œ ä»–å†³å®šé‡å†™ Compassï¼ŒæŠŠå®ƒå˜ä¸ºä¸€ä¸ªç‹¬ç«‹çš„æœåŠ¡å¹¶å–å Elasticsearchã€‚</p>
<p>ç¬¬ä¸€ä¸ªå…¬å¼€ç‰ˆæœ¬åœ¨2010å¹´2æœˆå‘å¸ƒï¼Œä»æ­¤ä»¥åï¼ŒElasticsearch å·²ç»æˆä¸ºäº† Github ä¸Šæœ€æ´»è·ƒçš„é¡¹ç›®ä¹‹ä¸€ï¼Œä»–æ‹¥æœ‰è¶…è¿‡300å contributors(ç›®å‰736å contributors )ã€‚ ä¸€å®¶å…¬å¸å·²ç»å¼€å§‹å›´ç»• Elasticsearch æä¾›å•†ä¸šæœåŠ¡ï¼Œå¹¶å¼€å‘æ–°çš„ç‰¹æ€§ï¼Œä½†æ˜¯ï¼ŒElasticsearch å°†æ°¸è¿œå¼€æºå¹¶å¯¹æ‰€æœ‰äººå¯ç”¨ã€‚</p>
<p>æ®è¯´ï¼ŒShay çš„å¦»å­è¿˜åœ¨ç­‰ç€å¥¹çš„é£Ÿè°±æœç´¢å¼•æ“â€¦â€‹</p>
</blockquote>
<ul>
<li>2005å¹´ï¼Œlucene æˆä¸º Apache é¡¶çº§é¡¹ç›®</li>
</ul>
<h4 id="3-2006å¹´5æœˆå‘å¸ƒ-20"><a class="header" href="#3-2006å¹´5æœˆå‘å¸ƒ-20">ï¼ˆ3ï¼‰ 2006å¹´5æœˆï¼Œå‘å¸ƒ 2.0</a></h4>
<h4 id="4-2009å¹´11æœˆå‘å¸ƒ-30"><a class="header" href="#4-2009å¹´11æœˆå‘å¸ƒ-30">ï¼ˆ4ï¼‰ 2009å¹´11æœˆï¼Œå‘å¸ƒ 3.0</a></h4>
<ul>
<li>
<p>2010å¹´2æœˆ7æ—¥ï¼ŒElasticsearch 0.1.0 å‘å¸ƒ</p>
</li>
<li>
<p>2010å¹´ï¼Œsolr ä½œä¸ºluceneå­é¡¹ç›®ï¼Œåˆå¹¶å…¥lucene</p>
</li>
<li>
<p>2011å¹´ï¼Œtwitter ä½¿ç”¨ lucene å®ç°å®æ—¶æœç´¢</p>
</li>
</ul>
<h3 id="5-2012å¹´å‘å¸ƒ-40"><a class="header" href="#5-2012å¹´å‘å¸ƒ-40">ï¼ˆ5ï¼‰ 2012å¹´ï¼Œå‘å¸ƒ 4.0</a></h3>
<ul>
<li>
<p>æ˜¯ä¸€ä¸ª&quot;é©å‘½æ€§&quot;ç‰ˆæœ¬ï¼Œè®©lucene è¿›å…¥ä¸¥è‚ƒåˆ†æé¢†åŸŸï¼Œ(1) æ·»åŠ ç¼–ç /è§£ç å™¨; (2) æ–°å¢ç›¸ä¼¼æ€§åˆ†ææ¨¡å‹(BM25, DFR)</p>
</li>
<li>
<p>2012å¹´2æœˆ9æ—¥ï¼ŒElasticå…¬å¸æˆç«‹</p>
</li>
</ul>
<h3 id="6-2015å¹´å‘å¸ƒ-50"><a class="header" href="#6-2015å¹´å‘å¸ƒ-50">ï¼ˆ6ï¼‰ 2015å¹´ï¼Œå‘å¸ƒ 5.0</a></h3>
<h3 id="7-2016å¹´å‘å¸ƒ-60"><a class="header" href="#7-2016å¹´å‘å¸ƒ-60">ï¼ˆ7ï¼‰ 2016å¹´ï¼Œå‘å¸ƒ 6.0</a></h3>
<ul>
<li>
<p>æ·»åŠ äº†å¯¹å¤šç»´ç´¢å¼•çš„æ”¯æŒ BKDæ ‘</p>
</li>
<li>
<p>å°†BM25 è®¾ç½®ä¸ºé»˜è®¤ç›¸ä¼¼æ€§æ¨¡å‹ï¼Œä¹‹å‰æ˜¯ TF/IDF</p>
</li>
<li>
<p>lucene æºç ä» Subversion è½¬ç§»åˆ° git</p>
</li>
</ul>
<h3 id="8-2017å¹´å‘å¸ƒ-70"><a class="header" href="#8-2017å¹´å‘å¸ƒ-70">ï¼ˆ8ï¼‰ 2017å¹´ï¼Œå‘å¸ƒ 7.0</a></h3>
<h3 id="9-2019å¹´å‘å¸ƒ-80"><a class="header" href="#9-2019å¹´å‘å¸ƒ-80">ï¼ˆ9ï¼‰ 2019å¹´ï¼Œå‘å¸ƒ 8.0</a></h3>
<h3 id="10-2021å¹´å‘å¸ƒ-90"><a class="header" href="#10-2021å¹´å‘å¸ƒ-90">ï¼ˆ10ï¼‰ 2021å¹´ï¼Œå‘å¸ƒ 9.0</a></h3>
<ul>
<li>solr ç‹¬ç«‹å‡º luceneï¼Œæˆä¸ºApache é¡¶çº§é¡¹ç›®</li>
</ul>
<p><img src="https://github.com/Kua-Fu/blog-book-images/blob/main/elastic-101/lucene/shayBanon.png?raw=true" alt="elastic" /></p>
<h2 id="äºŒå†™å…¥ç´¢å¼•"><a class="header" href="#äºŒå†™å…¥ç´¢å¼•">äºŒã€å†™å…¥ï¼ˆç´¢å¼•ï¼‰</a></h2>
<h3 id="21-å€’æ’ç´¢å¼•-inverted-index"><a class="header" href="#21-å€’æ’ç´¢å¼•-inverted-index">2.1 å€’æ’ç´¢å¼• Inverted index</a></h3>
<p><img src="https://github.com/Kua-Fu/blog-book-images/blob/main/elastic-101/lucene/doc-index.png?raw=true" alt="index" /></p>
<p>âš ï¸ MySQL 8.0 ä¹Ÿå®ç°äº†å€’æ’ç´¢å¼• ï¼ˆ 2018/4/19 ï¼‰</p>
<h3 id="22-ç´¢å¼•æµç¨‹"><a class="header" href="#22-ç´¢å¼•æµç¨‹">2.2 ç´¢å¼•æµç¨‹</a></h3>
<ul>
<li>
<p>ä¸€èˆ¬å…ˆæŠŠä¸åŒæ ¼å¼çš„æ–‡æœ¬ï¼Œå…ˆè½¬å˜ä¸ºç‰¹å®šæ ¼å¼æ–‡æœ¬(json)</p>
</li>
<li>
<p>æ¯ä¸ªæ–‡æ¡£è¦ç¡®å®šfieldç»“æ„ï¼Œæ¯ä¸ªfieldéƒ½éœ€è¦ç»è¿‡åˆ†æå™¨åˆ†æåï¼Œæœ€ç»ˆæŒä¹…åŒ–</p>
</li>
<li>
<p>åˆ†æå™¨åˆ†æè¿‡ç¨‹ï¼Œä¼šæµå¼ç»è¿‡ä¸åŒç±»å‹çš„åˆ†æå™¨ï¼Œäº§ç”Ÿtokenåˆ—è¡¨</p>
</li>
</ul>
<p><img src="https://github.com/Kua-Fu/blog-book-images/blob/main/elastic-101/lucene/index-1.png?raw=true" alt="i1" /></p>
<p><img src="https://github.com/Kua-Fu/blog-book-images/blob/main/elastic-101/lucene/index-2.png?raw=true" alt="i2" /></p>
<p><img src="https://github.com/Kua-Fu/blog-book-images/blob/main/elastic-101/lucene/index-3.png?raw=true" alt="i3" /></p>
<p><img src="https://github.com/Kua-Fu/blog-book-images/blob/main/elastic-101/lucene/index-6.png?raw=true" alt="i6" /></p>
<table><thead><tr><th>æœ¯è¯­</th><th>æè¿°</th></tr></thead><tbody>
<tr><td>document</td><td>æ–‡æ¡£</td></tr>
<tr><td>field</td><td>æ–‡æ¡£ä¸­çš„å­—æ®µ</td></tr>
<tr><td>index</td><td>åè¯ï¼Œluceneä¸­æ–‡æ¡£ä¿å­˜çš„é›†åˆ</td></tr>
<tr><td>segment</td><td>æ®µï¼Œè¡¨ç¤ºå†™å…¥æ—¶å€™çš„commitç‚¹</td></tr>
<tr><td>term</td><td>luceneä¸­å­˜å‚¨å’Œæœç´¢çš„åŸºæœ¬å•å…ƒ</td></tr>
<tr><td>token</td><td>ç»è¿‡åˆ†è¯å™¨åï¼Œåˆ‡åˆ†çš„æœ€å°å•å…ƒ</td></tr>
</tbody></table>
<p>term å¯ä»¥ç†è§£ä¸º token åŠ ä¸Š fieldNameï¼Œä¾‹å¦‚ï¼š æ–‡æ¡£ä¸­titleå­—æ®µï¼Œå€¼ä¸º hello world, åˆ†æå™¨åˆ†æåï¼Œç”Ÿæˆ hello å’Œ worldä¸¤ä¸ªtokenï¼Œåˆ™ termä¹Ÿæ˜¯ä¸¤ä¸ª, &lt;title, hello&gt;, &lt;title, world&gt;</p>
<h3 id="23-lsmæ ‘å®ç°"><a class="header" href="#23-lsmæ ‘å®ç°">2.3 LSMæ ‘å®ç°</a></h3>
<p><img src="https://github.com/Kua-Fu/blog-book-images/blob/main/elastic-101/lucene/lsm-10.png?raw=true" alt="lsm region" /></p>
<p><a href="https://en.wikipedia.org/wiki/Log-structured_merge-tree">LSM tree (log-structured merge-tree) </a></p>
<p><a href="https://en.wikipedia.org/wiki/B-tree">B-tree</a></p>
<ul>
<li>
<p>æ˜¯ä¸€ç§å¯¹é¢‘ç¹å†™æ“ä½œéå¸¸å‹å¥½çš„æ•°æ®ç»“æ„ï¼ŒåŒæ—¶å…¼é¡¾äº†æŸ¥è¯¢æ•ˆç‡ã€‚</p>
</li>
<li>
<p>ä¹‹æ‰€ä»¥æœ‰æ•ˆæ˜¯åŸºäºä»¥ä¸‹äº‹å®ï¼šç£ç›˜æˆ–å†…å­˜çš„è¿ç»­è¯»å†™æ€§èƒ½è¿œé«˜äºéšæœºè¯»å†™æ€§èƒ½(å±€éƒ¨æ€§åŸç†)</p>
</li>
<li>
<p>æ˜¯è®¸å¤š key-value å‹æˆ–æ—¥å¿—å‹æ•°æ®åº“æ‰€ä¾èµ–çš„æ ¸å¿ƒæ•°æ®ç»“æ„ï¼Œä¾‹å¦‚ BigTableã€HBaseã€Cassandraã€LevelDBã€SQLiteã€Scyllaã€RocksDB ç­‰ã€‚</p>
</li>
</ul>
<p>LSMæ ‘ ä¸‰ä¸ªä¸»è¦ç»„æˆéƒ¨åˆ†: memtableï¼Œlogï¼ŒSSTable</p>
<ul>
<li>
<p>memtable</p>
<p>æ˜¯çº¢é»‘æ ‘æˆ–è€…è·³è¡¨è¿™æ ·çš„æœ‰åºå†…å­˜æ•°æ®ç»“æ„ï¼Œèµ·åˆ°ç¼“å­˜å’Œæ’åºçš„ä½œç”¨ï¼ŒæŠŠæ–°å†™å…¥çš„æ•°æ®æŒ‰ç…§é”®çš„å¤§å°è¿›è¡Œæ’åºã€‚å½“memtableåˆ°è¾¾ä¸€å®šå¤§å°ä¹‹åï¼Œä¼šè¢«è½¬åŒ–æˆSSTableæ ¼å¼åˆ·å…¥ç£ç›˜æŒä¹…åŒ–å­˜å‚¨</p>
</li>
<li>
<p>SSTableï¼ˆSorted String Tableï¼‰</p>
<p>è¯´ç™½äº†å°±æ˜¯ä¸€ä¸ªç‰¹æ®Šæ ¼å¼çš„æ–‡ä»¶ï¼Œå…¶ä¸­çš„æ•°æ®æŒ‰ç…§é”®çš„å¤§å°æ’åˆ—ï¼Œä½ å¯ä»¥æŠŠå®ƒç±»æ¯”æˆä¸€ä¸ªæœ‰åºæ•°ç»„ã€‚è€Œ LSM æ ‘ï¼Œè¯´ç™½äº†å°±æ˜¯è‹¥å¹²SSTableçš„é›†åˆã€‚</p>
</li>
<li>
<p>log</p>
<p>æ–‡ä»¶è®°å½•æ“ä½œæ—¥å¿—ï¼Œåœ¨æ•°æ®å†™å…¥memtableçš„åŒæ—¶ä¹Ÿä¼šåˆ·ç›˜å†™å…¥åˆ°logæ–‡ä»¶ï¼Œä½œç”¨æ˜¯æ•°æ®æ¢å¤ã€‚æ¯”å¦‚åœ¨memtableä¸­çš„æ•°æ®è¿˜æ²¡è½¬åŒ–æˆSSTableæŒä¹…åŒ–åˆ°ç£ç›˜æ—¶ï¼Œå¦‚æœçªç„¶æ–­ç”µï¼Œé‚£ä¹ˆmemtableé‡Œé¢çš„æ•°æ®éƒ½ä¼šä¸¢å¤±ï¼Œä½†æœ‰logæ–‡ä»¶åœ¨ï¼Œå°±å¯ä»¥æ¢å¤è¿™äº›æ•°æ®ã€‚å½“ç„¶ï¼Œç­‰memtableä¸­çš„æ•°æ®æˆåŠŸè½¬åŒ–æˆSSTableè½ç›˜ä¹‹åï¼Œlogæ–‡ä»¶ä¸­å¯¹åº”çš„æ“ä½œæ—¥å¿—å°±æ²¡å¿…è¦å­˜åœ¨äº†ï¼Œå¯ä»¥è¢«åˆ é™¤</p>
</li>
</ul>
<p><img src="https://github.com/Kua-Fu/blog-book-images/blob/main/elastic-101/lucene/lsm-0.png?raw=true" alt="RocksDB" /></p>
<p><img src="https://github.com/Kua-Fu/blog-book-images/blob/main/elastic-101/lucene/lsm-5.png?raw=true" alt="lsm" /></p>
<p><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/translog.html">æŒä¹…åŒ–å˜æ›´</a></p>
<h3 id="24-ç´¢å¼•æ–‡ä»¶"><a class="header" href="#24-ç´¢å¼•æ–‡ä»¶">2.4 ç´¢å¼•æ–‡ä»¶</a></h3>
<p>ä¸‹é¢æ˜¯<a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/codecs/lucene90/package-summary.html">lucene9.3.0</a> ä¸­çš„ç´¢å¼•æ–‡ä»¶ </p>
<p><img src="https://github.com/Kua-Fu/blog-book-images/blob/main/elastic-101/lucene/lucene-file-format.png?raw=true" alt="file" /></p>
<table><thead><tr><th>åºå·</th><th>æ–‡ä»¶åç¼€</th><th>æè¿°è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody>
<tr><td></td><td><a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/codecs/lucene90/Lucene90CompoundFormat.html">.cfs</a></td><td>An optional &quot;virtual&quot; file consisting of all the other index files for systems that frequently run out of file handles.</td><td></td></tr>
<tr><td></td><td><a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/codecs/lucene90/Lucene90CompoundFormat.html">.cfe</a></td><td>The &quot;virtual&quot; compound file's entry table holding all entries in the corresponding .cfs file.</td><td></td></tr>
<tr><td></td><td><a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/codecs/lucene90/Lucene90PostingsFormat.html">.doc</a></td><td>Frequencies and Skip Data</td><td></td></tr>
<tr><td></td><td><a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/codecs/lucene90/Lucene90DocValuesFormat.html">.dvd</a></td><td>DocValues data</td><td></td></tr>
<tr><td></td><td><a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/codecs/lucene90/Lucene90DocValuesFormat.html">.dvm</a></td><td>DocValues metadata</td><td></td></tr>
<tr><td></td><td><a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/codecs/lucene90/Lucene90StoredFieldsFormat.html">.fdt</a></td><td>This file stores a compact representation of documents in compressed blocks of 16KB or more. When writing a segment, documents are appended to an in-memory byte[] buffer. When its size reaches 16KB or more, some metadata about the documents is flushed to disk, immediately followed by a compressed representation of the buffer using the LZ4 compression format.</td><td></td></tr>
<tr><td></td><td><a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/codecs/lucene90/Lucene90StoredFieldsFormat.html">.fdx</a></td><td>This file stores two monotonic arrays, one for the first doc IDs of each block of compressed documents, and another one for the corresponding offsets on disk. At search time, the array containing doc IDs is binary-searched in order to find the block that contains the expected doc ID, and the associated offset on disk is retrieved from the second array.</td><td></td></tr>
<tr><td></td><td><a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/codecs/lucene90/Lucene90StoredFieldsFormat.html">.fdm</a></td><td>This file stores metadata about the monotonic arrays stored in the index file.</td><td></td></tr>
<tr><td></td><td><a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/codecs/lucene90/Lucene90FieldInfosFormat.html">.fnm</a></td><td>Field names are stored in the field info file</td><td></td></tr>
<tr><td></td><td><a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/codecs/lucene90/Lucene90PointsFormat.html">.kdm</a></td><td>A .kdm file that records metadata about the fields, such as numbers of dimensions or numbers of bytes per dimension.</td><td></td></tr>
<tr><td></td><td><a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/codecs/lucene90/Lucene90PointsFormat.html">.kdi</a></td><td>A .kdi file that stores inner nodes of the tree.</td><td></td></tr>
<tr><td></td><td><a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/codecs/lucene90/Lucene90PointsFormat.html">.kdd</a></td><td>A .kdd file that stores leaf nodes, where most of the data lives.</td><td></td></tr>
<tr><td></td><td><a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/codecs/lucene90/Lucene90LiveDocsFormat.html">.liv</a></td><td>The .liv file is optional, and only exists when a segment contains deletions.</td><td></td></tr>
<tr><td></td><td><a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/codecs/lucene90/Lucene90NormsFormat.html">.nvd</a></td><td>Norms data</td><td></td></tr>
<tr><td></td><td><a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/codecs/lucene90/Lucene90NormsFormat.html">.nvm</a></td><td>Norms metadata</td><td></td></tr>
<tr><td></td><td><a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/codecs/lucene90/Lucene90PostingsFormat.html">.pay</a></td><td>Payloads and Offsets</td><td></td></tr>
<tr><td></td><td><a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/codecs/lucene90/Lucene90PostingsFormat.html">.pos</a></td><td>Positions</td><td></td></tr>
<tr><td></td><td><a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/codecs/lucene90/Lucene90SegmentInfoFormat.html">.si</a></td><td>Header, SegVersion, SegSize, IsCompoundFile, Diagnostics, Files, Attributes, IndexSort, Footer</td><td></td></tr>
<tr><td></td><td><a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/codecs/lucene90/Lucene90PostingsFormat.html">.tim</a></td><td>Term Dictionary</td><td></td></tr>
<tr><td></td><td><a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/codecs/lucene90/Lucene90PostingsFormat.html">.tip</a></td><td>Term Index</td><td></td></tr>
<tr><td></td><td><a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/codecs/lucene90/Lucene90TermVectorsFormat.html">.tvm</a></td><td>A vector metadata file</td><td></td></tr>
<tr><td></td><td><a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/codecs/lucene90/Lucene90TermVectorsFormat.html">.tvd</a></td><td>This file stores terms, frequencies, positions, offsets and payloads for every document. Upon writing a new segment, it accumulates data into memory until the buffer used to store terms and payloads grows beyond 4KB. Then it flushes all metadata, terms and positions to disk using LZ4 compression for terms and payloads and blocks of packed ints for positions.</td><td></td></tr>
<tr><td></td><td><a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/codecs/lucene90/Lucene90TermVectorsFormat.html">.tvx</a></td><td>An index file</td><td></td></tr>
</tbody></table>
<p>âš ï¸ <a href="https://lucene.apache.org/core/3_0_3/fileformats.html">lucene3.0.3</a> ä¸­çš„æ–‡ä»¶æ ¼å¼</p>
<table><thead><tr><th>Name</th><th>Extension</th><th>Brief Description</th></tr></thead><tbody>
<tr><td>Segments File</td><td>segments.gen, segments_N</td><td>Stores information about segments</td></tr>
<tr><td>Lock File</td><td>write.lock</td><td>The Write lock prevents multiple IndexWriters from writing to the same file.</td></tr>
<tr><td>Compound File</td><td>.cfs</td><td>An optional &quot;virtual&quot; file consisting of all the other index files for systems that frequently run out of file handles.</td></tr>
<tr><td>Fields</td><td>.fnm</td><td>Stores information about the fields</td></tr>
<tr><td>Field Index</td><td>.fdx</td><td>Contains pointers to field data</td></tr>
<tr><td>Field Data</td><td>.fdt</td><td>The stored fields for documents</td></tr>
<tr><td>Term Infos</td><td>.tis</td><td>Part of the term dictionary, stores term info</td></tr>
<tr><td>Term Info Index</td><td>.tii</td><td>The index into the Term Infos file</td></tr>
<tr><td>Frequencies</td><td>.frq</td><td>Contains the list of docs which contain each term along with frequency</td></tr>
<tr><td>Positions</td><td>.prx</td><td>Stores position information about where a term occurs in the index</td></tr>
<tr><td>Norms</td><td>.nrm</td><td>Encodes length and boost factors for docs and fields</td></tr>
<tr><td>Term Vector Index</td><td>.tvx</td><td>Stores offset into the document data file</td></tr>
<tr><td>Term Vector Documents</td><td>.tvd</td><td>Contains information about each document that has term vectors</td></tr>
<tr><td>Term Vector Fields</td><td>.tvf</td><td>The field level info about term vectors</td></tr>
<tr><td>Deleted Documents</td><td>.del</td><td>Info about what files are deleted</td></tr>
</tbody></table>
<p><img src="https://github.com/Kua-Fu/blog-book-images/blob/main/elastic-101/lucene/file-format.png?raw=true" alt="file-format" /></p>
<p>å®¢æˆ·å®é™…ç¤ºä¾‹</p>
<table><thead><tr><th>æ–‡ä»¶</th><th>å¤§å°</th><th>è¯´æ˜</th></tr></thead><tbody>
<tr><td>wksp_975d8bf6d6204f9ca72efb65eaee718c_tracing-000033</td><td>303.8gb</td><td>ç´¢å¼•å¤§å°</td></tr>
<tr><td>fdt</td><td>154.2gb</td><td>ä¿å­˜æ¯ä¸ªæ–‡æ¡£çš„å±æ€§å€¼å¯¹åº”å…³ç³»</td></tr>
<tr><td>tim</td><td>57.8gb</td><td>term è¯å…¸</td></tr>
<tr><td>kdd</td><td>32.1gb</td><td><a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=173081898">å¤šç»´æ•°æ®ç»“æ„</a>ï¼Œå¶èŠ‚ç‚¹ä¿¡æ¯</td></tr>
<tr><td>dvd</td><td>20.7gb</td><td>åˆ—å¼å­˜å‚¨åŸå§‹å­—æ®µ</td></tr>
<tr><td>doc</td><td>8.6gb</td><td>termå‡ºç°çš„é¢‘ç‡</td></tr>
<tr><td>tip</td><td>947.7mb</td><td>termè¯å…¸çš„ç´¢å¼•ï¼Œå®é™…ä¸Šå³æ˜¯ä¸‹ç« ä»‹ç»çš„fstæ•°æ®ç»“æ„</td></tr>
</tbody></table>
<h3 id="25-fstæ•°æ®ç»“æ„"><a class="header" href="#25-fstæ•°æ®ç»“æ„">2.5 fstæ•°æ®ç»“æ„</a></h3>
<p><a href="https://blog.mikemccandless.com/2010/12/using-finite-state-transducers-in.html">Using Finite State Transducers in Lucene</a></p>
<p><a href="https://www.shenyanchao.cn/blog/2018/12/04/lucene-fst/">å…³äºLuceneçš„è¯å…¸FSTæ·±å…¥å‰–æ</a></p>
<h2 id="ä¸‰æŸ¥è¯¢"><a class="header" href="#ä¸‰æŸ¥è¯¢">ä¸‰ã€æŸ¥è¯¢</a></h2>
<h3 id="31-æŸ¥è¯¢æµç¨‹"><a class="header" href="#31-æŸ¥è¯¢æµç¨‹">3.1 æŸ¥è¯¢æµç¨‹</a></h3>
<ul>
<li>luceneæŸ¥è¯¢è¯­å¥ï¼Œå…ˆç»è¿‡è§£æå™¨ï¼Œç„¶åå†ç»è¿‡åŒæ ·çš„åˆ†æå™¨ï¼Œæœ€åæŸ¥è¯¢</li>
</ul>
<p><img src="https://github.com/Kua-Fu/blog-book-images/blob/main/elastic-101/lucene/search-1.png?raw=true" alt="s1" /></p>
<p><img src="https://github.com/Kua-Fu/blog-book-images/blob/main/elastic-101/lucene/search-2.png?raw=true" alt="s2" /></p>
<p><img src="https://github.com/Kua-Fu/blog-book-images/blob/main/elastic-101/lucene/search-3.png?raw=true" alt="s3" /></p>
<h3 id="32-ç›¸ä¼¼åº¦ç®—æ³•"><a class="header" href="#32-ç›¸ä¼¼åº¦ç®—æ³•">3.2 ç›¸ä¼¼åº¦ç®—æ³•</a></h3>
<p>(1)  TF/IDF</p>
<p><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/scoring-theory.html">ç›¸å…³åº¦è¯„åˆ†èƒŒåçš„ç†è®º</a></p>
<p>ç›¸å…³æ€§åˆ¤æ–­ä¸‰ä¸ªå…ƒç´ </p>
<p>a. æ£€ç´¢è¯é¢‘ç‡</p>
<p>æ£€ç´¢è¯åœ¨è¯¥å­—æ®µå‡ºç°çš„é¢‘ç‡ï¼Ÿå‡ºç°é¢‘ç‡è¶Šé«˜ï¼Œç›¸å…³æ€§ä¹Ÿè¶Šé«˜ã€‚ å­—æ®µä¸­å‡ºç°è¿‡ 5 æ¬¡è¦æ¯”åªå‡ºç°è¿‡ 1 æ¬¡çš„ç›¸å…³æ€§é«˜ã€‚</p>
<p>b. åå‘æ–‡æ¡£é¢‘ç‡</p>
<p>æ¯ä¸ªæ£€ç´¢è¯åœ¨ç´¢å¼•ä¸­å‡ºç°çš„é¢‘ç‡ï¼Ÿé¢‘ç‡è¶Šé«˜ï¼Œç›¸å…³æ€§è¶Šä½ã€‚æ£€ç´¢è¯å‡ºç°åœ¨å¤šæ•°æ–‡æ¡£ä¸­ä¼šæ¯”å‡ºç°åœ¨å°‘æ•°æ–‡æ¡£ä¸­çš„æƒé‡æ›´ä½ã€‚</p>
<p>c. å­—æ®µé•¿åº¦å‡†åˆ™</p>
<p>å­—æ®µçš„é•¿åº¦æ˜¯å¤šå°‘ï¼Ÿé•¿åº¦è¶Šé•¿ï¼Œç›¸å…³æ€§è¶Šä½ã€‚ æ£€ç´¢è¯å‡ºç°åœ¨ä¸€ä¸ªçŸ­çš„ title è¦æ¯”åŒæ ·çš„è¯å‡ºç°åœ¨ä¸€ä¸ªé•¿çš„ content å­—æ®µæƒé‡æ›´å¤§ã€‚</p>
<p>å…·ä½“çš„è®¡ç®—å…¬å¼ : <a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/search/similarities/TFIDFSimilarity.html">TFIDFSimilarity</a></p>
<p>(2) BM25 </p>
<p><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/pluggable-similarites.html">å¯æ’æ‹”çš„ç›¸ä¼¼åº¦ç®—æ³•</a></p>
<p>å…·ä½“å®ç°æ–¹å¼: <a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/search/similarities/BM25Similarity.html">BM25Similarity</a></p>
<h2 id="å››æ›´å¤šå†…å®¹"><a class="header" href="#å››æ›´å¤šå†…å®¹">å››ã€æ›´å¤šå†…å®¹</a></h2>
<h3 id="41-luceneä¸­çš„ç¼–ç è§£ç å¦‚ä½•å®ç°çš„"><a class="header" href="#41-luceneä¸­çš„ç¼–ç è§£ç å¦‚ä½•å®ç°çš„">4.1 luceneä¸­çš„ç¼–ç /è§£ç å¦‚ä½•å®ç°çš„?</a></h3>
<p><a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/codecs/package-summary.html">Codec</a> </p>
<p>Codecs API: API for customization of the encoding and structure of the index.</p>
<p><a href="https://help.aliyun.com/document_detail/363036.html">ä½¿ç”¨aliyun-codecæ’ä»¶</a></p>
<h3 id="42-luceneä¸­çš„å­˜å‚¨ç±»å‹"><a class="header" href="#42-luceneä¸­çš„å­˜å‚¨ç±»å‹">4.2 luceneä¸­çš„å­˜å‚¨ç±»å‹?</a></h3>
<p>NioFsï¼ˆ æ³¨ï¼šéé˜»å¡æ–‡ä»¶ç³»ç»Ÿï¼‰å’Œ MMapFs ï¼ˆ æ³¨ï¼šå†…å­˜æ˜ å°„æ–‡ä»¶ç³»ç»Ÿï¼‰é›¶æ‹·è´æŠ€æœ¯ï¼Ÿ</p>
<p><a href="https://lucene.apache.org/core/9_3_0/core/org/apache/lucene/store/FSDirectory.html">FSDirectory</a></p>
<h3 id="43-force-mergeè¿‡ç¨‹-luceneä¸­çš„äº‹åŠ¡"><a class="header" href="#43-force-mergeè¿‡ç¨‹-luceneä¸­çš„äº‹åŠ¡">4.3 force mergeè¿‡ç¨‹, luceneä¸­çš„äº‹åŠ¡</a></h3>
<p><a href="https://blog.mikemccandless.com/2012/03/transactional-lucene.html">Transactional Lucene</a></p>
<h3 id="44-æºç åˆ†æ"><a class="header" href="#44-æºç åˆ†æ">4.4 æºç åˆ†æ</a></h3>
<h3 id="45-åˆ†å¸ƒå¼æ¶æ„--èšåˆåˆ†æ--æœºå™¨å­¦ä¹ "><a class="header" href="#45-åˆ†å¸ƒå¼æ¶æ„--èšåˆåˆ†æ--æœºå™¨å­¦ä¹ ">4.5 åˆ†å¸ƒå¼æ¶æ„ / èšåˆåˆ†æ / æœºå™¨å­¦ä¹ </a></h3>
<h3 id="46-ç¤¾åŒºè´¡çŒ®-å®é™…ä½¿ç”¨--å¼€å‘æ–°åŠŸèƒ½-ç­‰"><a class="header" href="#46-ç¤¾åŒºè´¡çŒ®-å®é™…ä½¿ç”¨--å¼€å‘æ–°åŠŸèƒ½-ç­‰">4.6 ç¤¾åŒºè´¡çŒ® ï¼ˆå®é™…ä½¿ç”¨ / å¼€å‘æ–°åŠŸèƒ½ ç­‰ï¼‰</a></h3>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->

        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
